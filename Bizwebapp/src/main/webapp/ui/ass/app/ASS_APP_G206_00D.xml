<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ev="http://www.w3.org/2001/xml-events"
    xmlns:w2="http://www.inswave.com/websquare" xmlns:xf="http://www.w3.org/2002/xforms">
    <head meta_programName="자산불용신청">
    	<w2:type>DEFAULT</w2:type>
        <w2:buildDate/>
        <xf:model>
        	<xf:instance>
        		<data xmlns="" />
        	</xf:instance>
        	<w2:dataCollection baseNode="map">
        		<w2:dataMap baseNode="map" id="dma_search">
        			<w2:keyInfo>
        				<w2:key id="req_no" name="신청번호" dataType="text"></w2:key>
        			</w2:keyInfo>
        		</w2:dataMap>
        		<w2:dataList baseNode="list" id="dlt_grd" repeatNode="map" saveRemovedData="true">
        			<w2:columnInfo>
        				<w2:column id="req_no" name="req_no" dataType="text"></w2:column>
        				<w2:column id="req_nm" name="req_nm" dataType="text"></w2:column>
        				<w2:column id="req_empno" name="req_empno" dataType="text"></w2:column>
        				<w2:column id="req_syspayno" name="req_syspayno" dataType="text"></w2:column>
        				<w2:column id="req_dept_cd" name="req_dept_cd" dataType="text"></w2:column>
        				<w2:column id="req_dept_new_ymd" name="req_dept_new_ymd" dataType="text"></w2:column>
        				<w2:column id="req_email" name="req_email" dataType="text"></w2:column>
        				<w2:column id="req_ext_no" name="req_ext_no" dataType="text"></w2:column>
        				<w2:column id="req_dept_nm" name="req_dept_nm" dataType="text"></w2:column>
        				<w2:column id="unuse_clsf" name="unuse_clsf" dataType="text"></w2:column>
        				<w2:column id="respn_nm" name="respn_nm" dataType="text"></w2:column>
        				<w2:column id="re_use_possbl" name="re_use_possbl" dataType="text"></w2:column>
        				<w2:column id="repay_aftr_econo_value" name="repay_aftr_econo_value" dataType="text"></w2:column>
        				<w2:column id="mngmt_state" name="mngmt_state" dataType="text"></w2:column>
        				<w2:column id="etc_item" name="etc_item" dataType="text"></w2:column>
        				<w2:column id="cause" name="cause" dataType="text"></w2:column>
        				<w2:column id="idle_unuse_clsf" name="idle_unuse_clsf" dataType="text"></w2:column>
        				<w2:column id="user_nm" name="user_nm" dataType="text"></w2:column>
        				<w2:column id="user_empno" name="user_empno" dataType="text"></w2:column>
        				<w2:column id="aset_no" name="aset_no" dataType="text"></w2:column>
        				<w2:column id="aset_clsf" name="aset_clsf" dataType="text"></w2:column>
        				<w2:column id="relat_aset_no" name="relat_aset_no" dataType="text"></w2:column>
        				<w2:column id="main_sub_clsf" name="main_sub_clsf" dataType="text"></w2:column>
        				<w2:column id="aset_nm" name="aset_nm" dataType="text"></w2:column>
        				<w2:column id="aset_typ" name="aset_typ" dataType="text"></w2:column>
        				<w2:column id="aset_clsf_nm" name="aset_clsf_nm" dataType="text"></w2:column>
        				<w2:column id="main_sub_clsf_nm" name="main_sub_clsf_nm" dataType="text"></w2:column>
        				<w2:column id="intro_amt" name="intro_amt" dataType="text"></w2:column>
        				<w2:column id="intro_ymd" name="intro_ymd" dataType="text"></w2:column>
        				<w2:column id="posi_region" name="posi_region" dataType="text"></w2:column>
        				<w2:column id="posi_build" name="posi_build" dataType="text"></w2:column>
        				<w2:column id="posi_region_nm" name="posi_region_nm" dataType="text"></w2:column>
        				<w2:column id="posi_build_nm" name="posi_build_nm" dataType="text"></w2:column>
        				<w2:column id="posi_floor" name="posi_floor" dataType="text"></w2:column>
        				<w2:column id="posi_detls" name="posi_detls" dataType="text"></w2:column>
        				<w2:column id="prcs_ymd" name="prcs_ymd" dataType="text"></w2:column>
        				<w2:column id="prcs_amt" name="prcs_amt" dataType="text"></w2:column>
        				<w2:column id="prcs_clsf" name="prcs_clsf" dataType="text"></w2:column>
        				<w2:column id="attach_file_no" name="attach_file_no" dataType="text"></w2:column>
        				<w2:column id="user_dept_cd" name="user_dept_cd" dataType="text"></w2:column>
        				<w2:column id="user_dept_cd_ymd" name="user_dept_cd_ymd" dataType="text"></w2:column>
        				<w2:column id="manager_id" name="manager_id" dataType="text"></w2:column>
        				<w2:column id="app_div" name="신청구분" dataType="text"></w2:column>
        				<w2:column id="aset_state_clsf" name="aset_state_clsf" dataType="text"></w2:column>
        				<w2:column id="chk" name="chk" dataType="text"></w2:column>
        				<w2:column id="cud_type" name="cud_type" dataType="text"></w2:column>
        				<w2:column id="syspayno" name="개인번호" dataType="text"></w2:column>
        				<w2:column id="apr_state" name="결재상태" dataType="text"></w2:column>
        			</w2:columnInfo>
        		</w2:dataList>
        		<w2:dataMap baseNode="map" id="dma_mast">
        			<w2:keyInfo>
        				<w2:key id="nm" name="이름" dataType="text"></w2:key>
        				<w2:key id="empno" name="사원번호" dataType="text"></w2:key>
        				<w2:key id="syspayno" name="개인시스템번호" dataType="text"></w2:key>
        				<w2:key id="email" name="이메일" dataType="text"></w2:key>
        				<w2:key id="dept_cd" name="그룹코드" dataType="text"></w2:key>
        				<w2:key id="dept_new_ymd" name="신청자부서" dataType="text"></w2:key>
        				<w2:key id="dept_nm" name="소속부서" dataType="text"></w2:key>
        				<w2:key id="depthed_nm" name="상위" dataType="text"></w2:key>
        				<w2:key id="ext_no" name="전화번호" dataType="text"></w2:key>
        				<w2:key id="save_clsf" name="저장구분" dataType="text"></w2:key>
        				<w2:key id="approval" name="결재신청" dataType="text"></w2:key>
        				<w2:key id="aset_typ" name="자산타입" dataType="text"></w2:key>
        			</w2:keyInfo>
        		</w2:dataMap>
        		<w2:dataMap baseNode="map" id="dma_listSearch">
        			<w2:keyInfo>
        				<w2:key id="relat_aset_no" name="relat_aset_no" dataType="text"></w2:key>
        			</w2:keyInfo>
        		</w2:dataMap>
        		<w2:dataList baseNode="list" repeatNode="map" id="dlt_assList" saveRemovedData="true">
        			<w2:columnInfo>
        				<w2:column id="aset_typ" name="aset_typ" dataType="text"></w2:column>
        				<w2:column id="aset_clsf" name="aset_clsf" dataType="text"></w2:column>
        				<w2:column id="aset_clsf_nm" name="aset_clsf_nm" dataType="text"></w2:column>
        				<w2:column id="aset_no" name="aset_no" dataType="text"></w2:column>
        				<w2:column id="main_sub_clsf" name="main_sub_clsf" dataType="text"></w2:column>
        				<w2:column id="main_sub_clsf_nm" name="main_sub_clsf_nm" dataType="text"></w2:column>
        				<w2:column id="relat_aset_no" name="relat_aset_no" dataType="text"></w2:column>
        				<w2:column id="aset_nm" name="aset_nm" dataType="text"></w2:column>
        				<w2:column id="old_aset_no" name="old_aset_no" dataType="text"></w2:column>
        				<w2:column id="intro_ymd" name="intro_ymd" dataType="text"></w2:column>
        				<w2:column id="intro_amt" name="intro_amt" dataType="text"></w2:column>
        				<w2:column id="user_syspayno" name="user_syspayno" dataType="text"></w2:column>
        				<w2:column id="user_empno" name="user_empno" dataType="text"></w2:column>
        				<w2:column id="user_nm" name="user_nm" dataType="text"></w2:column>
        				<w2:column id="user_dept_cd" name="user_dept_cd" dataType="text"></w2:column>
        				<w2:column id="user_dept_new_ymd" name="user_dept_new_ymd" dataType="text"></w2:column>
        				<w2:column id="posi_region" name="posi_region" dataType="text"></w2:column>
        				<w2:column id="posi_build" name="posi_build" dataType="text"></w2:column>
        				<w2:column id="posi_region_nm" name="posi_region_nm" dataType="text"></w2:column>
        				<w2:column id="posi_build_nm" name="posi_build_nm" dataType="text"></w2:column>
        				<w2:column id="posi_floor" name="posi_floor" dataType="text"></w2:column>
        				<w2:column id="posi_detls" name="posi_detls" dataType="text"></w2:column>
        				<w2:column id="manager_id" name="manager_id" dataType="text"></w2:column>
        			</w2:columnInfo>
        		</w2:dataList>
        		<w2:dataMap baseNode="map" id="dma_restoration" style="">
        			<w2:keyInfo>
        				<w2:key dataType="text" id="req_no" name="신청번호"></w2:key>
        				<w2:key id="aset_no" name="name2" dataType="text"></w2:key>
        			</w2:keyInfo>
        		</w2:dataMap>
        	</w2:dataCollection>
        	<w2:workflowCollection></w2:workflowCollection>
        	<!-- 조회 -->
        	<xf:submission id="sbm_selectData" ref="data:json,dma_search" target='' action="SvcASSAPPASSSR01.pwkjson" method="post"
        		mediatype="application/json" encoding="UTF-8" instance="" replace="" errorHandler="" customHandler="" mode="asynchronous"
        		processMsg="" ev:submit="" ev:submitdone="" ev:submiterror="" abortTrigger="">
        	</xf:submission>
        	<!-- 저장-->
        	<xf:submission id="sbm_saveData" ref='data:json,[{"id":"dlt_grd","key":"asetList"},{"id":"dma_mast","key":"assUnUseMastVo"}]'
        		target='data:json,dma_search' action="SvcASSAPPASSSI01.pwkjson" method="post" mediatype="application/json" encoding="UTF-8"
        		instance="" replace="" errorHandler="" customHandler="" mode="asynchronous" processMsg="" ev:submit="" ev:submitdone=""
        		ev:submiterror="" abortTrigger="">
        	</xf:submission>
        	<!-- 목록조회 -->
        	<xf:submission id="sbm_selectList" ref="data:json,dma_listSearch" target='' action="SvcASSAPPLISTR01.pwkjson" method="post"
        		mediatype="application/json" encoding="UTF-8" instance="" replace="" errorHandler="" customHandler="" mode="asynchronous"
        		processMsg="" ev:submit="" ev:submitdone="" ev:submiterror="" abortTrigger="">
        	</xf:submission>
        	<!-- 삭제 -->
        	<xf:submission id="sbm_deleteData" ref='data:json,dma_search' target='' action="SvcASSAPPASSCD01.pwkjson" method="post"
        		mediatype="application/json" encoding="UTF-8" instance="" replace="" errorHandler="" customHandler="" mode="asynchronous"
        		processMsg="" ev:submit="" ev:submitdone="" ev:submiterror="" abortTrigger="">
        	</xf:submission>

        	<xf:submission abortTrigger="" action="SvcASSAPPASSU02.pwkjson" customHandler="" encoding="UTF-8" errorHandler="" ev:submit=""
        		ev:submitdone="" ev:submiterror="" id="sbm_restoration" instance="" mediatype="application/json" method="post" mode="asynchronous"
        		processMsg="" ref='data:json,dma_restoration' replace=""
        		target="" style="">
        	</xf:submission>
        </xf:model>
        <script src="/cm/js/biz/ass.js" cache="false" />
        <script type="text/javascript" lazy="false"><![CDATA[
	/****************************************************
	 * 화면 설명 : 불용신청dma_mastdma_mast
	 * 변경 이력 : 2023-07-25	심용보	최초 작성
	 * ServiceId : g206
	 ****************************************************/
	/**
	 * 페이지 로딩 이벤트
	 */
	scwin.onpageload = function() {
		// 신규 정보 등록을 위한 DataMap 초기화
		com.initDataMap(dma_search);

		// enter key event - 신청자명 검색
		com.setEnterKeyEvent(grp_emp, scwin.btn_emp_onclick);

		var param = com.getParameter();
		
		if (param.param4 == "apr") {
			btn_pre.hide();
		}

		// parameter 설정
		dma_search.setJSON(param);

		// 공통코드
		var codeOptions = [{
							code : "HCF",		// 위치(지역)
							compID : "grd_list:instl_region"
						} 
		];
		
		com.setCmnCd(codeOptions, function() {
			if(dma_search.get("req_no") != "") {
				dma_mast.set("save_clsf", "update");
				scwin.search();
			}else {
				dma_mast.set("save_clsf", "insert");
				radioAppDiv.setItemDisabled(1 , true); // 최초 신청은 불용신청으로 작성하고 결재가 완료될 경우 롤코드에 의해서 신청구분을 수정할 수 있도록 한다.
				
				if (com.getLoginInfo("roleCode").indexOf("1015117") < 0) {
					ibx_empno.setValue(com.getLoginInfo("empno")); // sn, cn
					btn_emp.trigger("click");
				}
			}
		});

		btn_print.setDisabled(true);
		btn_biztripPlus.hide();
	}

	scwin.onpageunload = function() {

	}

	/**
	 * 조회
	 */
	scwin.search = function() {
		com.execute(sbm_selectData, {
			successCallback : function(e) {
				var aprState = "";
				var req_no = "";
				var roleCode = com.getLoginInfo("roleCode");

				dlt_grd.setJSON(e.responseJSON.assUnUseVoList);
				grd_list.setFocusedCell(0, 0);
				
				aprState = dlt_grd.getCellData(0, "apr_state");
				req_no = dlt_grd.getCellData(0, "req_no");

				// 결재상태에 따른 버튼제어
				com.biz.disabledButtons(aprState, req_no);
				btn_print.setDisabled(false);

				dma_mast.set("syspayno", dlt_grd.getCellData(0, "req_syspayno"));
				
				if (aprState == "XAD100") {
					if (roleCode.indexOf("1015117") > 0) { // 자산관리시스템관리자의 경우만 신청구분을 변경할 수 있음.
						radioAppDiv.setItemDisabled(1, false);
						btn_save.setDisabled(false);
					} else {
						radioAppDiv.setDisabled(true);
					}
					radioAsetTyp.setDisabled(true);
					btn_trigger1.setDisabled(true);
					btn_biztripMin.setDisabled(true);
					ibx_empno.setDisabled(true);
					btn_emp.setDisabled(true);
				} else {
					radioAppDiv.setItemDisabled(1, true);
				}
			}
		});
	}

	/**
	 * 목록 조회
	 */
	scwin.listSearch = function() {
		com.execute(sbm_selectList, {
			successCallback : function(e) {
				dlt_grd.setJSON(e.responseJSON.assMastrBVoList);
				grd_list.setFocusedCell(0, 0);
				
				ibx_empno.setValue(e.responseJSON.assMastrBVoList[0].user_empno);
				btn_emp.trigger("click");
			}
		});
	}

	//------------------------------------------------------------- event -------------------------------/	

	/**
	 * 저장전 체크
	 */
	scwin.preSave = function() {
		for (i = 0; i < dlt_grd.getRowCount(); i++) {
			dlt_grd.setCellData(i, "req_no", ibx_req_no.getValue());
			dlt_grd.setCellData(i, "aset_typ", radioAsetTyp.getValue());
			dlt_grd.setCellData(i, "app_div", radioAppDiv.getValue());
			dlt_grd.setCellData(i, "syspayno", dma_mast.get("syspayno"));
			dlt_grd.setCellData(i, "req_dept_cd", dma_mast.get("dept_cd"));
			dlt_grd.setCellData(i, "req_dept_new_ymd", dma_mast.get("dept_new_ymd"));
		}

		//		if(!com.validateData(dma_mast, [
		//			{id: "syspayno", mandatory :true}
		//		], false)) return false;
		//		
		// 필수입력값 체크
		var validData = [{
			dataObj : dma_mast,
			valInfoArr : [{
				id : "syspayno",
				mandatory : true
			}],
			isCheckModified : false
		}, {
			dataObj : dlt_grd,
			valInfoArr : [{
				id : "app_div",
				mandatory : true
			}],
			isCheckModified : false
		}];

		var chkDeptCd = "";

		for (var i = 0; i < dlt_grd.getRowCount(); i++) {
			if (i > 0) {
				if (dlt_grd.getCellData(i, "user_dept_cd") != chkDeptCd) {
					com.alert("불용신청은 같은 사용자 부서 단위로 신청 가능합니다.");
					return false;
				}
			}
			chkDeptCd = dlt_grd.getCellData(i, "user_dept_cd");
		}

		return com.validateData(validData);
	}

	/**
	 * 저장 버튼 클릭 이벤트
	 */
	scwin.btn_save_onclick = function(e) {
		if (!scwin.preSave()) return;

		dma_mast.set("approval", false);
		
		var chkArr = grd_list.getCheckedIndex("chk");
						
		// 신청구분이 환원이라면 불용 신청 내역 자산들을 선택해서 신청구분을 바꿀 수 있다.
		if(radioAppDiv.getValue() == "AHB040"){
			// 선택된 자산이 있어야 저장 가능
			if(chkArr.length == 0){
				com.alert("신청구분을 환원으로 변경할 자산을 선택해주세요.");
				return;
			}else{
				com.confirm("선택하신 자산의 신청구분을 환원으로 변경하시겠습니까?", function(ret) {
					if(ret){
						scwin.restoration();
					}else{
						return;
					}
				});
			}
		}else{
			com.confirm("message.xom.wq.017"/*저장 하시겠습니까?*/, function(ret) {
				if(ret){
					scwin.save();
				}
			});
		}
	}

	/*
	 * 저장
	 */
	scwin.save = function() {
		com.execute(sbm_saveData, {
			successCallback : function(e) { // 성공 콜백	
				if (dma_mast.get("approval")) {
					// 결재화면 이동
					com.movePageMenu("A001", {
						"reqNo" : dma_search.get("req_no")
					});
				} else {
					com.alert("message.xom.wq.023"/*정상적으로 처리되었습니다.*/, function() {
						scwin.search();
					});
				}
			}

		});
	}
	
	// 결재완료된 자산에 한해서 신청구분을 불용 => 환원으로 변경할 수 있다.
	scwin.restoration = function(){
		var chkArr = grd_list.getCheckedIndex("chk");
		var paramAssetNo = "";
		
		for(i=0; i < chkArr.length; i++){
			paramAssetNo += "'" + dlt_grd.getCellData(chkArr[i], "aset_no") + "',";
		}
		paramAssetNo = paramAssetNo.substring(0, paramAssetNo.lastIndexOf(","));
		
		dma_restoration.set("req_no", ibx_req_no.getValue());
		dma_restoration.set("aset_no", paramAssetNo.toString());
		
		com.execute(sbm_restoration, {
			successCallback : function(e) { // 성공 콜백
				com.alert("선택한 자산 신청구분이 환원으로 변경되었습니다.", function() {
					scwin.search();
				});
			}
		});
	}

	/**
	 * 삭제 버튼 클릭 이벤트
	 */
	scwin.btn_del_onclick = function(e) {
		if (dlt_grd.getCellData(0, "apr_state") > "XAD020") {
			com.alert("결재중이므로 삭제할 수 없습니다.");
			return;
		}
		dma_search.set("req_no", ibx_req_no.getValue());

		com.confirm("message.xom.wq.022"/*삭제 하시겠습니까?*/, function(ret) {
			if (ret) {
				com.file.deleteAll(function() {
					com.execute(sbm_deleteData, {
						successCallback : function(e) { // 성공 콜백
							com.alert("message.xom.wq.023"/*정상적으로 처리되었습니다.*/, function() {
								com.moveList("G204");
							});
						}
					});
				});
			}
		});
	}

	/**
	 * 닫기 버튼 클릭 이벤트
	 */
	scwin.btn_close_onclick = function(e) {
		if (scwin.data.saveFlag) {
			com.closePopup({});
		} else {
			com.closePopup();
		}
	}

	/**
	 * 인원 조회 버튼 클릭 이벤트
	 */
	scwin.btn_emp_onclick = function(e) {
		var data = {
			empno : ibx_empno.getValue(),
			ref_yn : (ibx_empno.getValue() == "") ? "Y" : "N"
		};
		
		com.pop.open(com.pop.TYPE.HUM, data, function(ret) {
			dma_mast.set("syspayno", ret.syspayno);
			dma_mast.set("dept_cd", ret.dept_cd);
			dma_mast.set("dept_new_ymd", ret.dept_new_ymd);
			
			// 검색한 정보 컴포넌트에 셋팅
			ibx_empno.setValue(ret.empno);
			ibx_nm.setValue(ret.nm);
			ibx_email.setValue(ret.email);
			ibx_dept_nm.setValue(ret.dept_nm);
			ibx_ext_no.setValue(ret.ext_no);
			ibx_depthed_nm.setValue(ret.depthed_nm);
		});

	}

	/*
	 * 자산조회 버튼 클릭 이벤트
	 */
	scwin.btn_trigger1_onclick = function(e) {
		scwin.assAppSearch();
	}

	scwin.assAppSearch = function() {
		var data = {
			biz_clsf : "S"
		};
		var options = {
			id : "COM_01P",
			popupName : "자산정보조회",
			width : 800,
			height : 450,
			top : 50,
			left : 20,
			useIFrame : true,
			modal : true
		};

		com.openPopup("/ui/ass/pop/ASS_POP_COM_01P.xml", options, data,	function(ret) {
			var cnt = ret;
			var relat_aset_no = "";

			for (var i = 0; i < cnt.length; i++) {
				var colAsetNo = ret[i].aset_no;

				if (colAsetNo.substring(0, 1) != "A"
						&& colAsetNo.substring(0, 1) != "B") {
					com.alert("수량자산입니다. \n수량은 불용신청을 하지 않습니다.");
					return;
				}

				if (0 < i) {
					relat_aset_no += "',"
				}

				relat_aset_no += "'" + colAsetNo;
			}
			relat_aset_no += "'";

			console.log("relat_aset_no : ", relat_aset_no);

			dma_listSearch.set("relat_aset_no", relat_aset_no);

			scwin.listSearch();
		});
	}

	/*
	 * 조달청 내용인수 확인하기 클릭 이벤트
	 */
	scwin.btn_anchor1_onclick = function() {
		scwin.downFileinfo("내용연수(조달청고시 제2018-14호).hwp", "asspps");
	}
	
	/*
	 * 연구시설장비 저분 불용신청 양식 클릭 이벤트
	 */
	scwin.btn_anchor2_onclick = function() {
		scwin.downFileinfo("(양식) 불용신청장비 현황.hwp", "assdisposal");
	}
	
	/*
	 * 파일 다운로드
	 */
	scwin.downFileinfo = function downFileinfo(file_nm, file_no) {
		var url = "/SvcAttachDown.do?fileName=web_folder/bizdoc/fin/" + file_no
				+ "&realName=" + encodeURIComponent(file_nm) + "&bizKind=OLD";
		window.open(url, '_blank').focus();
	}

	/*
	 * 자산 추가
	 */
	scwin.btn_biztripPlus_onclick = function(e) {
		com.addRow(grd_list);
	}

	/*
	 * 자산 제거
	 */
	scwin.btn_biztripMin_onclick = function(e) {

		var rows = grd_list.getCheckedIndex("chk");
		if (rows.length == 0) {
			com.alert(com.getMsg("message.xom.co.com.0003", "삭제할 행"));
			return;
		}

		rows.reverse().forEach(function(rowIndex) {
			dlt_grd.removeRow(rowIndex);
		});
	}

	/*
	 * 결재신청 버튼 클릭 이벤트
	 */
	scwin.btn_apr_onclick = function(e) {
		if (!scwin.preSave())
			return;

		// 기존 로직은 기술장비와 다른 자산을 같이 저장할 수 없었으나,
		// 2022-09-01 불용 신청 내역에 자산분루가 기술장비랑 다른 장비가 섞여있을 경우 기술장비는 자산상태정보를 입력해야 결재신청이 가능하도록 수정
		for (var i = 0; i < dlt_grd.getRowCount(); i++) {
			if (dlt_grd.getCellData(i, "aset_clsf") == "ABA050"
					|| dlt_grd.getCellData(i, "aset_clsf") == "ABA120") {
				if (dlt_grd.getCellData(i, "aset_state_clsf").trim() == ""
						|| dlt_grd.getCellData(i, "aset_state_clsf").trim() == null) {
					com.alert("자산상태정보를 입력해야 결재신청이 가능합니다.\n자산의 품명을 눌러서 상세정보를 입력해주세요.");
					return;
				}
			}
		}
		dma_mast.set("approval", true);
		dma_mast.set("aset_typ", radioAsetTyp.getText());

		scwin.save();
	}
	
	scwin.btn_pre_onclick = function(e) {
		com.moveList('G204');
	}

	scwin.grd_list_oncellclick = function(row, col, colId) {
		if (colId == "aset_nm") {
			var data = {};

			data.req_no = dlt_grd.getCellData(row, "req_no");
			data.aset_no = dlt_grd.getCellData(row, "aset_no");
			
			// TODO - 업무공통 스크립트(ass.js)에서 호출하도록 변경필요
			//com.openPopup("/ui/ass/app/ASS_APP_G222_00P.xml", options, data, function(ret) {
			biz.ass.pop.open(biz.ass.pop.TYPE.DS_CHA_REQ_DTL, data, function(ret) {
				
			});
			
		} else if (colId == "aset_no") {
			// TODO - 퍼블 완료후 작업  AssRegAssDtlLst.xml

		}
	}

	/**
	 * 인쇄 버튼 클릭시 이벤트
	 */
	scwin.btn_print_onclick = function(e) {
		if (dlt_grd.getCellData(0, "req_no")) {
			com.oz.openPopup( {
				formAlias : dlt_grd.getCellData(0, "req_no").substring(0,3),
				reqNo : dlt_grd.getCellData(0, "req_no"),
				snapFrame : grp_main.getID()
			});
		} 
	}
	]]></script>
    </head>
    <body ev:onpageload="scwin.onpageload" ev:onpageunload="scwin.onpageunload">
    	<w2:wframe id="wfm_title" src="/cm/xml/contentTitle.xml" style=""></w2:wframe>
    	<xf:group class="pageWrap" id="grp_main" style="">
    		<xf:group class="searchSection step" id="" style="">
    			<xf:group class="le" id="">
    				<xf:trigger class="btn " id="btn_pre" style="" type="button" ev:onclick="scwin.btn_pre_onclick">
    					<xf:label><![CDATA[목록]]></xf:label>
    				</xf:trigger>
    			</xf:group>
    			<xf:group class="btnbox" id="">
    				<xf:trigger class="btn icon print" id="btn_print" style="" type="button" ev:onclick="scwin.btn_print_onclick">
    					<xf:label><![CDATA[인쇄]]></xf:label>
    				</xf:trigger>
    				<xf:trigger class="btn blue" id="btn_apr" style="" type="button" disabled="true" ev:onclick="scwin.btn_apr_onclick">
    					<xf:label><![CDATA[결재신청]]></xf:label>
    				</xf:trigger>
    			</xf:group>
    		</xf:group>
    		<xf:group class="titleSection" id="" style="">
    			<xf:group class="le" id="">
    				<w2:span class="note red" id="" label="* 자산 불용신청 시 사용자 외의 타인이 대신 신청하는 경우, 사용자를 결재선에 반드시 넣어주시기 바랍니다." style=""></w2:span>
    			</xf:group>
    			<xf:group class="ri" id=""></xf:group>
    		</xf:group>
    		<xf:group class="w2tb tbl" id="" style="" tagname="table">
    			<w2:attributes>
    				<w2:summary></w2:summary>
    			</w2:attributes>
    			<xf:group tagname="caption"></xf:group>
    			<xf:group tagname="colgroup">
    				<xf:group style="width:240px;" tagname="col"></xf:group>
    				<xf:group style="" tagname="col"></xf:group>
    				<xf:group style="width:240px;" tagname="col"></xf:group>
    				<xf:group style="" tagname="col"></xf:group>
    			</xf:group>
    			<xf:group tagname="tr">
    				<xf:group class="w2tb_th" tagname="th">
    					<w2:attributes>
    						<w2:scope>row</w2:scope>
    					</w2:attributes>
    					<w2:textbox id="" label="자산구분" style="" tagname="span"></w2:textbox>
    				</xf:group>
    				<xf:group class="w2tb_td" tagname="td">
    					<w2:attributes></w2:attributes>
    					<xf:select1 appearance="full" class="radioGroup" cols="" id="radioAsetTyp" renderType="radiogroup" rows=""
    						selectedIndex="0" style="" ref="data:dlt_grd.aset_typ">
    						<xf:choices>
    							<xf:item>
    								<xf:label><![CDATA[자산]]></xf:label>
    								<xf:value><![CDATA[AAA010]]></xf:value>
    							</xf:item>
    							<xf:item>
    								<xf:label><![CDATA[관리대상시작품]]></xf:label>
    								<xf:value><![CDATA[AAA020]]></xf:value>
    							</xf:item>
    						</xf:choices>
    					</xf:select1>
    				</xf:group>
    				<xf:group class="w2tb_th" tagname="th">
    					<w2:attributes>
    						<w2:scope>row</w2:scope>
    					</w2:attributes>
    					<w2:textbox id="" label="불용 신청서 번호" style="" tagname="span"></w2:textbox>
    				</xf:group>
    				<xf:group class="w2tb_td" tagname="td">
    					<w2:attributes></w2:attributes>
    					<w2:span escape="false" id="ibx_req_no" label="000" style="" ref="data:dlt_grd.req_no">
    					</w2:span>
    				</xf:group>
    			</xf:group>
    			<xf:group tagname="tr">
    				<xf:group class="w2tb_th" tagname="th">
    					<w2:attributes>
    						<w2:scope>row</w2:scope>
    					</w2:attributes>
    					<w2:textbox id="" label="신청구분" style="" tagname="span"></w2:textbox>
    				</xf:group>
    				<xf:group class="w2tb_td" tagname="td">
    					<w2:attributes>
    						<w2:colspan>3</w2:colspan>
    						<w2:rowspan>1</w2:rowspan>
    					</w2:attributes>
    					<xf:select1 appearance="full" class="radioGroup" cols="" id="radioAppDiv" renderType="radiogroup" rows=""
    						selectedIndex="0" style="" ref="data:dlt_grd.app_div">
    						<xf:choices>
    							<xf:item>
    								<xf:label><![CDATA[불용]]></xf:label>
    								<xf:value><![CDATA[AHB000]]></xf:value>
    							</xf:item>
    							<xf:item>
    								<xf:label><![CDATA[환원]]></xf:label>
    								<xf:value><![CDATA[AHB040]]></xf:value>
    							</xf:item>
    						</xf:choices>
    					</xf:select1>
    				</xf:group>
    			</xf:group>
    		</xf:group>
    		<xf:group class="titleSection" id="" style="">
    			<w2:textbox class="tit_tbl" id="" label="불용 신청자 정보" style="" tagname="h3"></w2:textbox>
    		</xf:group>
    		<xf:group class="w2tb tbl" id="" style="" tagname="table">
    			<w2:attributes>
    				<w2:summary></w2:summary>
    			</w2:attributes>
    			<xf:group tagname="caption"></xf:group>
    			<xf:group tagname="colgroup">
    				<xf:group style="width:240px;" tagname="col"></xf:group>
    				<xf:group style="" tagname="col"></xf:group>
    				<xf:group style="width:240px;" tagname="col"></xf:group>
    				<xf:group style="" tagname="col"></xf:group>
    			</xf:group>
    			<xf:group tagname="tr">
    				<xf:group class="w2tb_th" tagname="th">
    					<w2:attributes>
    						<w2:scope>row</w2:scope>
    					</w2:attributes>
    					<w2:textbox id="" label="신청자" style="" tagname="span"></w2:textbox>
    				</xf:group>
    				<xf:group class="w2tb_td" tagname="td">
    					<w2:attributes></w2:attributes>
    					<xf:group class="inpSch" id="grp_emp" style="width: 100px;">
    						<xf:input adjustMaxLength="false" class="inp" id="ibx_empno" style="" title="사용자명" ref="data:dlt_grd.req_empno"></xf:input>
    						<xf:trigger class="btn" id="btn_emp" style="" title="주관자 검색" type="button" ev:onclick="scwin.btn_emp_onclick">
    							<xf:label><![CDATA[검색]]></xf:label>
    						</xf:trigger>
    					</xf:group>
    					<xf:input adjustMaxLength="false" class="inp" id="ibx_nm" style="width: 100px;" title="사용자 정보" disabled="true" ref="data:dlt_grd.req_nm"></xf:input>
    				</xf:group>
    				<xf:group class="w2tb_th" tagname="th">
    					<w2:attributes>
    						<w2:scope>row</w2:scope>
    					</w2:attributes>
    					<w2:textbox id="" label="이메일" style="" tagname="span"></w2:textbox>
    				</xf:group>
    				<xf:group class="w2tb_td" tagname="td">
    					<w2:attributes></w2:attributes>
    					<w2:span escape="false" ev:ondblclick="scwin.spn_req_no_ondblclick" id="ibx_email" label="000"
    						style="" ref="data:dlt_grd.req_email">
    					</w2:span>
    				</xf:group>
    			</xf:group>
    			<xf:group tagname="tr">
    				<xf:group tagname="th" class="w2tb_th">
    					<w2:attributes>
    						<w2:scope>row</w2:scope>
    					</w2:attributes>
    					<w2:textbox id="" label="부서명" style="" tagname="span"></w2:textbox>
    				</xf:group>
    				<xf:group tagname="td" class="w2tb_td">
    					<w2:attributes></w2:attributes>
    					<w2:span escape="false" ev:ondblclick="scwin.spn_req_no_ondblclick" id="ibx_dept_nm" label="000"
    						style="" ref="data:dlt_grd.req_dept_nm">
    					</w2:span>
    				</xf:group>
    				<xf:group tagname="th" class="w2tb_th">
    					<w2:attributes>
    						<w2:scope>row</w2:scope>
    					</w2:attributes>
    					<w2:textbox id="" label="연락처" style="" tagname="span"></w2:textbox>
    				</xf:group>
    				<xf:group tagname="td" class="w2tb_td">
    					<w2:attributes></w2:attributes>
    					<w2:span escape="false" ev:ondblclick="scwin.spn_req_no_ondblclick" id="ibx_ext_no" label="000"
    						style="" ref="data:dlt_grd.req_ext_no">
    					</w2:span>
    				</xf:group>
    			</xf:group>
    			<xf:group tagname="tr">
    				<xf:group class="w2tb_th" tagname="th">
    					<w2:attributes>
    						<w2:scope>row</w2:scope>
    					</w2:attributes>
    					<w2:textbox id="" label="사용책임자" style="" tagname="span"></w2:textbox>
    				</xf:group>
    				<xf:group class="w2tb_td" tagname="td">
    					<w2:attributes>
    						<w2:colspan>3</w2:colspan>
    						<w2:rowspan>1</w2:rowspan>
    					</w2:attributes>
    					<w2:span escape="false" ev:ondblclick="scwin.spn_req_no_ondblclick" id="ibx_depthed_nm" label="000"
    						ref="data:dlt_grd.respn_nm" style="">
    					</w2:span>
    				</xf:group>
    			</xf:group>
    		</xf:group>
    		<w2:anchor class="linkfile mt10" id="btn_anchor1" outerDiv="false" style="" ev:onclick="scwin.btn_anchor1_onclick">
    			<xf:label><![CDATA[[조달청 내용연수 확인하기]]></xf:label>
    		</w2:anchor>
    		<w2:anchor class="linkfile mt5" id="btn_anchor2" outerDiv="false" style="" ev:onclick="scwin.btn_anchor2_onclick">
    			<xf:label><![CDATA[연구시설장비 처분 불용신청 양식]]></xf:label>
    		</w2:anchor>
    		<xf:group class="titleSection" id="" style="">
    			<xf:group class="le" id="">
    				<w2:textbox class="tit_tbl" id="" label="불용 신청 내역" style="" tagname="h3"></w2:textbox>
    			</xf:group>
    			<xf:group class="ri" id="">
    				<xf:group class="btnarea" id="" style="">
    					<xf:trigger class="btn" id="btn_trigger1" style="" type="button" ev:onclick="scwin.btn_trigger1_onclick">
    						<xf:label><![CDATA[자산조회]]></xf:label>
    					</xf:trigger>
    					<xf:trigger class="bt_plus" id="btn_biztripPlus" style="" type="button" ev:onclick="scwin.btn_biztripPlus_onclick">
    						<xf:label><![CDATA[추가]]></xf:label>
    					</xf:trigger>
    					<xf:trigger class="bt_minus" id="btn_biztripMin" style="" type="button" ev:onclick="scwin.btn_biztripMin_onclick">
    						<xf:label><![CDATA[삭제]]></xf:label>
    					</xf:trigger>
    				</xf:group>
    			</xf:group>
    		</xf:group>
    		<w2:gridView autoFit="allColumn" class="grid" dataList="data:dlt_grd" defaultCellHeight="28" evenRowBackgroundColor="#f7faff"
    			id="grd_list" noResultMessage="조회 결과가 없습니다." noResultMessageClass="noResult" rowMouseOverColor="#e7f0fb" rowNumBackgroundColor="#fff"
    			rowNumHeaderValue="No." rowNumVisible="true" rowNumWidth="60" rowStatusHeaderValue="상태" rowStatusVisible="false" rowStatusWidth="50"
    			scrollByColumn="false" scrollByColumnAdaptive="false" selectedCellColor="#fbf2cd" selectedRowColor="#fbf2cd" style="height:113px;"
    			visibleRowNum="10" ev:oncellclick="scwin.grd_list_oncellclick" sortable="true">
    			<w2:caption id="caption1" style="" value="this is a grid caption."></w2:caption>
    			<w2:header id="header1" style="">
    				<w2:row id="row1" style="">
    					<w2:column checkboxLabel="전체선택" displayMode="label" fixColumnWidth="true" id="column1" inputType="checkbox"
    						readOnly="false" style="height:28px;" value="선택" width="45">
    					</w2:column>
    					<w2:column displayMode="label" id="column9" inputType="text" style="height:28px;" value="M/S 구분" width="100"></w2:column>
    					<w2:column displayMode="label" id="column7" inputType="text" style="height:28px;" value="자산분류" width="100"></w2:column>
    					<w2:column displayMode="label" id="column5" inputType="text" style="height:28px;" value="자산 번호" width="100"></w2:column>
    					<w2:column displayMode="label" id="column3" inputType="text" sortable="true" style="height:28px;" value="관련 자산 번호"
    						width="100">
    					</w2:column>
    					<w2:column width="70" inputType="text" style="height:28px" id="column35" value="품명" displayMode="label"></w2:column>
    					<w2:column displayMode="label" id="column20" inputType="text" style="height:28px;" value="취득금액" width="100"></w2:column>
    					<w2:column displayMode="label" id="column21" inputType="text" style="height:28px" value="취득일자" width="100"></w2:column>
    					<w2:column displayMode="label" id="column23" inputType="text" style="height:28px" value="사용자" width="100"></w2:column>
    					<w2:column width="100" inputType="text" style="height:28px" id="column25" value="위치(지역)" displayMode="label"></w2:column>
    					<w2:column width="100" inputType="text" style="height:28px" id="column27" value="위치(건물)" displayMode="label"></w2:column>
    					<w2:column width="100" inputType="text" style="height:28px" id="column29" value="위치(층)" displayMode="label"></w2:column>
    					<w2:column width="100" inputType="text" style="height:28px" id="column31" value="위치(상세)" displayMode="label"></w2:column>
    					<w2:column width="100" inputType="text" style="height:28px" id="column33" value="신청구분" displayMode="label"></w2:column>
    				</w2:row>
    			</w2:header>
    			<w2:gBody id="gBody1" style="">
    				<w2:row id="row2" style="">
    					<w2:column checkboxLabel="선택" displayMode="label" id="chk" inputType="checkbox" readOnly="false"
    						style="height:28px;" width="50">
    					</w2:column>
    					<w2:column displayMode="label" id="main_sub_clsf_nm" inputType="text" readOnly="true" style="height:28px;"
    						width="100">
    					</w2:column>
    					<w2:column displayMode="label" id="aset_clsf_nm" inputType="text" readOnly="true" style="height:28px;" value=""
    						width="100">
    					</w2:column>
    					<w2:column class="le" displayMode="label" escape="false" id="aset_no" inputType="text" readOnly="true"
    						style="height:28px;" width="100">
    					</w2:column>
    					<w2:column displayMode="label" id="relat_aset_no" inputType="text" readOnly="true" style="height:28px;"
    						width="100">
    					</w2:column>
    					<w2:column width="70" inputType="link" style="height:28px" id="aset_nm" value="" displayMode="label"
    						readOnly="true">
    					</w2:column>
    					<w2:column displayMode="label" id="intro_amt" inputType="text" readOnly="true" style="height:28px;" width="100" dataType="number" displayFormat="#,###"></w2:column>
    					<w2:column displayMode="label" id="intro_ymd" inputType="text" style="height:28px" value="" width="100"
    						readOnly="true" dataType="date">
    					</w2:column>
    					<w2:column displayMode="label" id="user_nm" inputType="text" style="height:28px" value="" width="100"
    						readOnly="true">
    					</w2:column>
    					<w2:column width="100" inputType="text" style="height:28px" id="posi_region_nm" value="" displayMode="label"
    						readOnly="true">
    					</w2:column>
    					<w2:column width="100" inputType="text" style="height:28px" id="posi_build_nm" value="" displayMode="label"
    						readOnly="true">
    					</w2:column>
    					<w2:column width="100" inputType="text" style="height:28px" id="posi_floor" value="" displayMode="label"
    						readOnly="true">
    					</w2:column>
    					<w2:column width="100" inputType="text" style="height:28px" id="posi_detls" value="" displayMode="label"
    						readOnly="true">
    					</w2:column>
    					<w2:column width="100" inputType="select" style="height:28px" id="app_div" value="" displayMode="label"
    						readOnly="false" allOption="" chooseOption="" ref="">
    						<w2:choices>
    							<w2:item>
    								<w2:label><![CDATA[불용]]></w2:label>
    								<w2:value><![CDATA[AHB000]]></w2:value>
    							</w2:item>
    							<w2:item>
    								<w2:label><![CDATA[환원]]></w2:label>
    								<w2:value><![CDATA[AHB040]]></w2:value>
    							</w2:item>
    						</w2:choices>
    					</w2:column>
    				</w2:row>
    			</w2:gBody>
    			<w2:footer style="" id="footer1">
    				<w2:row style="" id="row3">
    					<w2:column width="45" inputType="text" style="height:20px" id="column49" value="" displayMode="label"></w2:column>
    					<w2:column width="300" inputType="text" style="height:20px;" id="column48" value="합 계" displayMode="label" colSpan="3"
    						rowSpan="">
    					</w2:column>
    					<w2:column width="100" inputType="text" style="height:20px" id="column45" value="" displayMode="label"></w2:column>
    					<w2:column width="70" inputType="text" style="height:20px" id="column44" value="" displayMode="label"></w2:column>
    					<w2:column width="100" inputType="expression" style="height:20px" id="column43" value="" displayMode="label" expression="sum('intro_amt')" dataType="number" displayFormat="#,###"></w2:column>
    					<w2:column width="100" inputType="text" style="height:20px" id="column42" value="" displayMode="label"></w2:column>
    					<w2:column width="100" inputType="text" style="height:20px" id="column41" value="" displayMode="label"></w2:column>
    					<w2:column width="100" inputType="text" style="height:20px" id="column40" value="" displayMode="label"></w2:column>
    					<w2:column width="100" inputType="text" style="height:20px" id="column39" value="" displayMode="label"></w2:column>
    					<w2:column width="100" inputType="text" style="height:20px" id="column38" value="" displayMode="label"></w2:column>
    					<w2:column width="100" inputType="text" style="height:20px" id="column37" value="" displayMode="label"></w2:column>
    					<w2:column width="100" inputType="text" style="height:20px" id="column36" value="" displayMode="label"></w2:column>
    				</w2:row>
    			</w2:footer>
    		</w2:gridView>
    		<xf:group class="btnGroup" id="" style="">
    			<xf:group class="le" id="" style=""></xf:group>
    			<xf:group class="ri" id="">
    				<xf:trigger class="btn pro" id="btn_del" style="" type="button" disabled="true" ev:onclick="scwin.btn_del_onclick">
    					<xf:label><![CDATA[삭제]]></xf:label>
    				</xf:trigger>
    				<xf:trigger class=" btn pro conf" id="btn_save" style="" type="button" ev:onclick="scwin.btn_save_onclick">
    					<xf:label><![CDATA[저장]]></xf:label>
    				</xf:trigger>
    			</xf:group>
    		</xf:group>
    		<xf:group class="helparea no circle" id="" style="">
    			<w2:textbox class="helptitle" id="" label="[저활용, 유휴 장비 설명]" style=""></w2:textbox>
    			<xf:group id="" style="" tagname="ul">
    				<xf:group id="" tagname="li">
    					<w2:textbox class="" id="" label="(저활용) 정상가동은 가능하나 구축 후 사용 및 사양저조, 경제적 보유 수준이 적합하지 않은 이유 등으로 가동률이 연간 10% 미만인 시설장비"
    						style="" tagname="span">
    					</w2:textbox>
    					<w2:textbox class="dis_block" id="" label="※ 범용성 장비의 경우, 연간 200시간 미만 또는 연간 52회 미만으로 활용되는 장비는 저활용  시설장비로 판정할 것을 권고"
    						style="" tagname="span">
    					</w2:textbox>
    				</xf:group>
    				<xf:group id="" style="" tagname="li">
    					<w2:textbox class="" escape="false" id="" label="(유휴) 정상가동은 가능하나 구축 후 활용성 상실 등의 이유로 최근 6개월간 가동이 중지되어 있는 시설장비"
    						style="" tagname="span">
    					</w2:textbox>
    					<w2:textbox class="dis_block" id="" label="※ 가동률 산정이 어려운 경우 이에 대한 소명자료를 자체장비심의위원회에 제출" style="" tagname="span">
    					</w2:textbox>
    				</xf:group>
    			</xf:group>
    		</xf:group>
    	</xf:group>
    </body>
</html>
