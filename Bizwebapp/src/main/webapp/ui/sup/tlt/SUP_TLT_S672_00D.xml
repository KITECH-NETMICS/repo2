<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ev="http://www.w3.org/2001/xml-events"
    xmlns:w2="http://www.inswave.com/websquare" xmlns:xf="http://www.w3.org/2002/xforms">
    <head meta_programName="활동보고서등록" meta_vertical_guides="" meta_horizontal_guides="">
    	<w2:type>DEFAULT</w2:type>
        <w2:buildDate/>
        <xf:model>
            <xf:instance>
                <data xmlns=""/>
            </xf:instance>
            <w2:dataCollection baseNode="map">
            	<w2:dataMap baseNode="map" id="dma_search">
            		<w2:keyInfo>
            			<w2:key id="param_clsf" name="param_clsf" dataType="text"></w2:key>
            			<w2:key id="req_no" name="req_no" dataType="text"></w2:key>
            			<w2:key id="syspayno" name="syspayno" dataType="text"></w2:key>
            			<w2:key id="cust_no" name="cust_no" dataType="text"></w2:key>
            			<w2:key id="rpt_yrmon" name="rpt_yrmon" dataType="text"></w2:key>
            		</w2:keyInfo>
            	</w2:dataMap>
            	<w2:dataList baseNode="list" repeatNode="map" id="dlt_cust" saveRemovedData="true">
            		<w2:columnInfo>
				       <w2:column id="cust_no" name="cust_no" dataType="text"></w2:column>
				       <w2:column id="cmpy_nm_krchar" name="cmpy_nm_krchar" dataType="text"></w2:column>
            		</w2:columnInfo>
            	</w2:dataList>
            	<w2:dataMap baseNode="map" id="dma_hum">
            		<w2:keyInfo>
				       <w2:key id="syspayno" name="syspayno" dataType="text"></w2:key>
				       <w2:key id="empno" name="empno" dataType="text"></w2:key>
				       <w2:key id="nm" name="nm" dataType="text"></w2:key>
				       <w2:key id="posi_cd" name="posi_cd" dataType="text"></w2:key>
				       <w2:key id="posi_nm" name="posi_nm" dataType="text"></w2:key>
				       <w2:key id="cust_no" name="cust_no" dataType="text"></w2:key>
				       <w2:key id="cmpy_nm_krchar" name="cmpy_nm_krchar" dataType="text"></w2:key>
				       <w2:key id="reprs_psn" name="reprs_psn" dataType="text"></w2:key>
            		</w2:keyInfo>
            	</w2:dataMap>
            	<w2:dataMap baseNode="map" id="dma_info">
            		<w2:keyInfo>
            			<w2:key id="cud_type" name="cud_type" dataType="text"></w2:key>
            			<w2:key id="approval" name="결재신청" dataType="text"></w2:key>
            			<w2:key id="cust_no" name="참여기업" dataType="text"></w2:key>
            			<w2:key id="cmpy_nm_krchar" name="cmpy_nm_krchar" dataType="text"></w2:key>
            			<w2:key id="reprs_psn" name="reprs_psn" dataType="text"></w2:key>
            			<w2:key id="cmpy_addr" name="cmpy_addr" dataType="text"></w2:key>
            			<w2:key id="syspayno" name="syspayno" dataType="text"></w2:key>
            			<w2:key id="nm" name="nm" dataType="text"></w2:key>
            			<w2:key id="posi_nm" name="posi_nm" dataType="text"></w2:key>
            			<w2:key id="req_no" name="req_no" dataType="text"></w2:key>
            			<w2:key id="rpt_yrmon" name="보고년월" dataType="text"></w2:key>
            			<w2:key id="req_div" name="req_div" dataType="text"></w2:key>
            			<w2:key id="req_state" name="req_state" dataType="text"></w2:key>
            			<w2:key id="req_state_nm" name="req_state_nm" dataType="text"></w2:key>
            			<w2:key id="rmk" name="rmk" dataType="text"></w2:key>
            			<w2:key id="attach_file_no" name="attach_file_no" dataType="text"></w2:key>
            			<w2:key id="docu_clsf" name="docu_clsf" dataType="text"></w2:key>
            			<w2:key id="succ_cnt" name="succ_cnt" dataType="text"></w2:key>
            			<w2:key id="result_code" name="result_code" dataType="text"></w2:key>
            		</w2:keyInfo>
            	</w2:dataMap>
            	<w2:dataList baseNode="list" repeatNode="map" id="dlt_rpt" saveRemovedData="true">
            		<w2:columnInfo>
				       <w2:column id="chk" name="chk" dataType="text"></w2:column>
				       <w2:column id="that_month_div" name="that_month_div" dataType="text"></w2:column>
				       <w2:column id="that_month_goal" name="that_month_goal" dataType="text"></w2:column>
				       <w2:column id="that_month_result" name="that_month_result" dataType="text"></w2:column>
				       <w2:column id="rmk" name="rmk" dataType="text"></w2:column>
				       <w2:column id="req_no" name="req_no" dataType="text"></w2:column>
				       <w2:column id="seq" name="seq" dataType="text"></w2:column>
            		</w2:columnInfo>
            	</w2:dataList>
            	<w2:dataList baseNode="list" repeatNode="map" id="dlt_pln" saveRemovedData="true">
            		<w2:columnInfo>
				       <w2:column id="chk" name="chk" dataType="text"></w2:column>
				       <w2:column id="next_month_div" name="next_month_div" dataType="text"></w2:column>
				       <w2:column id="next_month_goal" name="next_month_goal" dataType="text"></w2:column>
				       <w2:column id="rmk" name="rmk" dataType="text"></w2:column>
				       <w2:column id="req_no" name="req_no" dataType="text"></w2:column>
				       <w2:column id="seq" name="seq" dataType="text"></w2:column>
            		</w2:columnInfo>
            	</w2:dataList>
            </w2:dataCollection>
            <w2:workflowCollection>
            </w2:workflowCollection>
			<!-- 참여기업 option 목록 조회 -->
    		<xf:submission id="sbm_selectSptCustList" ref='data:json,dma_search'
    			target='' action="SvcSUPTLTRPTMS01.pwkjson" method="post"
    			mediatype="application/json" encoding="UTF-8" mode="asynchronous">
    		</xf:submission>
			<!-- 참여기업 option 선택한 정보 조회 -->
    		<xf:submission id="sbm_selectSkilHumBasIcInfo" ref='data:json,dma_search'
    			target='' action="SvcSUPTLTHUMSR01.pwkjson" method="post"
    			mediatype="application/json" encoding="UTF-8" mode="asynchronous">
    		</xf:submission>
			<!-- 상세 조회 -->
    		<xf:submission id="sbm_selectSptTltActivRptDetls" ref='data:json,dma_search'
    			target='' action="SvcSUPTLTRPTSR01.pwkjson" method="post"
    			mediatype="application/json" encoding="UTF-8" mode="asynchronous">
    		</xf:submission>
			<!-- 수정(등록) 처리 -->
    		<xf:submission id="sbm_saveSptTltActivRpt" ref='data:json,[{"id":"dma_info","key":"SptTltActivRptVo"},{"id":"dlt_rpt","key":"SptTltActivMonthRptVoList"},{"id":"dlt_pln","key":"SptTltActivMonthPlnVoList"}]'
    			target='' action="SvcSUPTLTRPTSI01.pwkjson" method="post"
    			mediatype="application/json" encoding="UTF-8" mode="asynchronous">
    		</xf:submission>
			<!-- 삭제 처리 -->
    		<xf:submission id="sbm_deleteSptTltActivRpt" ref='data:json,dma_info'
    			target='' action="SvcSUPTLTRPTSD01.pwkjson" method="post"
    			mediatype="application/json" encoding="UTF-8" mode="asynchronous">
    		</xf:submission>
        </xf:model>
         <script type="text/javascript" lazy="false"><![CDATA[
    /****************************************************
 	 * 화면 설명 : 활동보고서 등록
 	 * 변경 이력 : 						손태화  최초작성
 	 						2023-10-04	송선화 	화면수정
 	 * 서비스아이디 : S672
 	 ****************************************************/
 	scwin.cudType = "";
 	      
	scwin.onpageload = function() {
		// 첨부파일 컴포넌트 초기화
		com.file.init();
		// 초기세팅
		scwin.in_it();
	};
	
	scwin.onpageunload = function() {
	};
	
	scwin.in_it = function(){
		// 초기 파라미터 세팅
		dma_search.setJSON(com.getParameter()); // req_no
		scwin.mng_yn = com.getParameter().mng_yn;
		
		if(dma_search.get("req_no") != ""){ // 상세 조회
			scwin.search();
		}else{
			//btn_del.hide();
			//grp_gbt01.hide(); //  btn_apr | btn_rpt
			com.biz.disabledButtons(); // btn_del , btn_apr , btn_save , btn_upd
			dma_info.set("syspayno",com.getLoginInfo().sn);
			dma_search.set("syspayno",dma_info.get("syspayno"));
			// test용
			//dma_search.set('syspayno','20100526');
			scwin.search_cust();
			
			// 반려정보 숨김
			grp_gbt02.hide(); //  btn_up | btn_down
			grp_reject_rmk.hide();
			dma_info.set("cud_type", "C");
			
			// 첨부파일
			scwin.upload_setting("S672", "edit");
			
			var today = com.getServerDateTime();
			
			if(dma_search.get("rpt_yrmon") == "") 	dma_info.set("rpt_yrmon", gcm.date.addMonth(com.getServerDateTime(),-1).substring(0,6));
			else 									dma_info.set("rpt_yrmon", dma_search.get("rpt_yrmon"));
		}
	};
	
	// 참여기업목록 조회
	scwin.search_cust = function(){
		// SvcSUPTLTRPTMS01.pwkjson | SptTltActivRptService.java
		// kr.re.kitech.biz.sup.tlt.selectSptDisPatchPrcondList ( SptDisPatchPrcond_SQL_informix_MyBatis.xml )
		// AS-IS : kitech.sup.tlt.xda.SptDisPatchPrcondMS01
		com.execute(sbm_selectSptCustList, {
			successCallback : function(e) {
				dlt_cust.setJSON(	e.responseJSON.elData.SptDisPatchPrcondVoList);
			}
		});
	};
	
	// 결재상태와 권한에 따라 화면제어
	scwin.setArrangeObj = function() {
		console.log("req_state===="+dma_info.get("req_state"));
		if(dma_info.get("req_state") != "XAD015"){
			grp_gbt02.hide(); //  btn_up | btn_down
			grp_reject_rmk.hide();
		}
		
		ica_rpt_yrmon.setDisabled(true);
		
		// 첨부파일 세팅
		var attach_file_no = dma_info.get("attach_file_no").trim();
		if(attach_file_no == "") attach_file_no = "S672";
		
		com.biz.disabledButtons(dma_info.get("req_state"),dma_info.get("req_no")); // btn_del , btn_apr , btn_save , btn_upd
		if(dma_info.get("req_state") == "XAD070" || dma_info.get("req_state") == "XAD100"){ // 담당자 확인중 | 결재완료
			//btn_del.hide();
			//btn_apr.hide();
			//btn_save.hide();
			scwin.upload_setting(attach_file_no, "view");
		}else{
			scwin.upload_setting(attach_file_no, "edit");
		}
	};
	
	// 조회 실행
	scwin.search = function(){
		// SvcSUPTLTRPTSR01.pwkjson | SptTltActivRptService.java 
		// AS-IS 		: SptTltBasicBiz.java
		// 활동보고서정보 	: kr.re.kitech.biz.sup.tlt.selectSptTltActivRptDetail ( SptTltActivRpt_SQL_informix_MyBatis.xml )
		// AS-IS 		: kitech.sup.tlt.xda.SptTltRptInfoSS02
		// 당월실적		: kr.re.kitech.biz.sup.tlt.selectSptTltActivMonthRptList ( SptTltActivMonthRpt_SQL_informix_MyBatis.xml )
		// AS-IS		: kitech.sup.tlt.xda.SptTltActivRptMS03
		// 익월목표		: kr.re.kitech.biz.sup.tlt.selectSptTltActivMonthPlnList ( SptTltActivMonthPln_SQL_informix_MyBatis.xml )
		// AS-IS		: kitech.sup.tlt.xda.SptTltActivPlnMS01
		if(dma_info.get("req_no") != ""){
			dma_search.set("req_no", dma_info.get("req_no"));
		}
		
		com.execute(sbm_selectSptTltActivRptDetls, {
			successCallback : function(e) {
				dma_info.set("cud_type", "U");
				dlt_cust.setJSON(	e.responseJSON.elData.SptDisPatchPrcondVoList); // 기업목록
				dma_info.setJSON(	e.responseJSON.elData.SptTltActivRptVo); // 활동보고서정보
				dlt_rpt.setJSON(	e.responseJSON.elData.SptTltActivMonthRptVoList); // 당월실적
				dlt_pln.setJSON(	e.responseJSON.elData.SptTltActivMonthPlnVoList); // 익월목표
				scwin.search_after();
			}
		});
	};
	
	scwin.search_after = function(){
		sbx_cust_no.setValue(dma_info.get("cust_no"));
		sbx_cust_no.setDisabled(true);
		dma_search.set("syspayno",dma_info.get("syspayno"));
		// 결재상태와 권한에 따라 화면제어
		scwin.setArrangeObj();
	};
	
	// 목록 버튼 클릭 시
	scwin.btn_list_onclick = function(e) {
		if(scwin.mng_yn == "Y") com.moveList("S676");
		else 					com.moveList("S675");
	};
	
	// 첨부파일
	scwin.upload_setting = function(attach_file_no, mode){
		// 첨부파일 세팅
		var objs = [
			{uploadId:upload_A.getID(), fileKey : attach_file_no, mode: mode},
		];
		com.file.createMulti(objs, objs.shift(), function() {
		});	
	};
	
	// 참여기업 변경(선택) 시
	scwin.sbx_cust_no_onviewchange = function(info) {
		// 조회 및 세팅!!
		dma_search.set("cust_no",info.newValue);
		scwin.search_base();
	};
	
	// 기술지원직정보 조회
	scwin.search_base = function(){
		// SvcSUPTLTHUMSR01.pwkjson | SptTltActivRptService.java
		// kr.re.kitech.biz.sup.tlt.selectSkilHumBasIcInfo ( SptTltActivRpt_SQL_informix_MyBatis.xml )
		// AS-IS : kitech.sup.tlt.xda.HumBasicInfoSS02
		com.execute(sbm_selectSkilHumBasIcInfo, {
			successCallback : function(e) {
				//dma_hum.setJSON(	e.responseJSON.elData.SptTltActivRptVo);
				//scwin.search_base_after();
				dma_info.set("cust_no",e.responseJSON.elData.cust_no);
				dma_info.set("reprs_psn",e.responseJSON.elData.reprs_psn);
				dma_info.set("nm",e.responseJSON.elData.nm);
				dma_info.set("posi_nm",e.responseJSON.elData.posi_nm);
			}
		});
	};
	
	// 저장 버튼 클릭 시
	scwin.btn_save_onclick = function(e) {
		//cudType = "C";
		// 저장 전에 validation 체크 진행
		if(!scwin.pre_save()) return;
			
		com.confirm("message.xom.wq.017"/*저장 하시겠습니까?*/, function(ret){
			if(ret){
				scwin.aprYn = "N";
				dma_info.set("approval", "false");
				scwin.cudType = "C";
				scwin.save(scwin.cudType);
			}
		});
	};
	// 저장 전 확인
	scwin.pre_save = function(){
		if(!com.validateData(dma_info,[
			{ id : "cust_no", mandatory : true}
		   ,{ id : "rpt_yrmon", mandatory : true } 
		], false)) return false;
		// 저장전 세팅
		var	cdClsf01		= "XAD010";		// INFO 테이블
		var	cdClsf02		= "XAD070";		// 기본정보 테이블
		//dma_info.set("prcs_state", "C"); // 등록시 : C , 수정시 : U(조회시 U 로 변경됨)
		if(dma_info.get("cud_type") == "C"){
			cdClsf01		= "XAD010";		// INFO 테이블
			cdClsf02		= "XAD010";		// 기본정보 테이블
		}else{
			cdClsf01		= "XAD010";		// INFO 테이블
			cdClsf02		= "XAD070";		// 기본정보 테이블
		}
		// supapproval/cud_type = cud_type
		// supapproval/req_no = reqNo
		// supapproval/ui_id = serviceId
		// supapproval/apr_state = cdClsf01
		// supapproval/state_inform_flag = 1
		// supapproval/endpoints = uid
		// supapproval/result = "type2"
		
		// supapproval/login_user_id = uid
		// supapproval/reporter_id = prvSyspayno
		// supapproval/info_cd = selectboxCustNo.getText()
		// supapproval/ext2_cd = outputNm.getValue()
		// supapproval/ext3_cd = ext3Cd
		// supapproval/ext1_cd = ext1Cd
		
		dma_info.set("req_div","STU010");
		dma_info.set("req_state",cdClsf02);
		dma_info.set("docu_clsf","S12"); // supapproval/docu_clsf = "S12"
		//dma_info.set('mnt_syspayno',aaa);
		
		return true;
	};
	// 저장 처리
	scwin.save = function(cudType){
		// kitech.sup.tlt.xda.SptTltActivRptSS02 // 중복건수 확인
		// kitech.sup.tlt.xda.SptTltActivRptSS01 // 동일보고서 수정
		
		// kitech.sup.tlt.xda.SptTltRptInfoSS01
		// kitech.sup.tlt.xda.SptTltRptInfoSI01
		// kitech.sup.tlt.xda.SptTltRptInfoSU01
		
		// kitech.sup.tlt.xda.SptTltActivRptSI01
		
		// kitech.sup.tlt.xda.SptTltActivRptSI01
	
		// SvcSUPTLTRPTSI01.pwkjson | SptTltActivRptService.java
		// kr.re.kitech.biz.sup.edu.mergeSptTechEducInfo ( SptTltActivRpt_SQL_informix_MyBatis.xml )
		com.file.transport( function(attachObj){
			dma_info.set("attach_file_no", attachObj.upload_A);
			com.execute(sbm_saveSptTltActivRpt, {
				successCallback : function(e) {
					var resultCd = e.responseJSON.elData.result_code; //dma_info.get("result_code");
					var succFlag = e.responseJSON.elData.succ_cnt; //dma_info.get("succ_cnt");
					var reqNo = e.responseJSON.elData.req_no; 
					
					//console.log("elData===="+JSON.stringify(e.responseJSON.elData));
					//console.log("resultCd=="+resultCd+"succFlag=="+succFlag+"cust_no===="+dma_info.get("cust_no"));
					//console.log("result_code==="+dma_info.get("result_code")+"succ_cnt==="+dma_info.get("succ_cnt"));
					//resultCd==98succFlag==-1cust_no====115305
					if(succFlag == "0"){
						btn_apr.setDisabled(false);
						
						if(cudType == "C"){
							com.confirm("저장되었습니다.", function(ret) {
									if(ret){
										//scwin.cudType = "S";
										btn_apr.setDisabled(false);
										scwin.search();
									}
							});
								
						} else {
							// 저장상태가  'S' 일 경우
							switch(resultCd){
								case "99" : 
									com.alert("결재신청중 오류가 발생했습니다.!");			
									break;	
								default :
									btn_apr.setDisabled(true);
									btn_del.setDisabled(true);
									com.alert("결재신청이 완료되었습니다");		
									break;				
							}
						}
				} else {
					switch(resultCd){
						case "98" : 
							com.alert("해당월 작성중인 보고서가 있습니다.");			
							break;	
						default :
							com.alert("중복보고서 또는 알수 없는 오류가 발생 했습니다!");			
							break;			
					}
				}
				
				tbx_req_no.setValue(reqNo);
				/** ,
				exceptionCallback : function(resObj) {
					scwin.exceptionCallback(resObj);
				}**/
			}
			});
		});	
		
	};
	
	// 삭제 버튼 클릭 시 
	scwin.btn_del_onclick = function(e) {
		// cudType = "D";
		com.confirm("message.xom.wq.022"/*삭제 하시겠습니까?*/, function(ret) {
			if(ret){
				// SvcSUPEDUSPTSD01.pwkjson | SptTltActivRptService.java
				com.file.transport( function(attachObj){
					dma_info.set("attach_file_no", attachObj.upload_A);
					
					com.execute(sbm_deleteSptTltActivRpt, {
						successCallback : function(e) {
							com.alert("message.xom.wq.023"/*정상적으로 처리되었습니다.*/, function() {
								if(scwin.mng_yn == "Y") com.moveList("S676", {mod :"delete"});
								else					com.moveList("S675", {mod :"delete"});
							});
						} ,
						exceptionCallback : function(resObj) {
							scwin.exceptionCallback(resObj);
						}
					});
				});	
			}
		});
	};
	
	// 반려 GRP 숨기기 버튼 클릭 시
	scwin.btn_up_onclick = function(e) {
		grp_reject_rmk.hide();
	};
	
	// 반려 GRP 보이기 버튼 클릭 시
	scwin.btn_down_onclick = function(e) {
		grp_reject_rmk.show();
	};
	
	/////////// 당월실적 목록 START ///////////
	// 추가 버튼 클릭
	scwin.btn_rpt_add_onclick = function(e) {
		var row = com.addRow(grd_rpt);
	};
	
	// 삭제 버튼 클릭
	scwin.btn_rpt_del_onclick = function(e) {
		var rows = grd_rpt.getCheckedIndex("chk");
		if(rows.length == 0){
			alert("삭제 할 행을 선택해 주십시오");
			return;
		}
			
		rows.reverse().forEach(function(row) {
			dlt_rpt.removeRow(row);
		});
	};
	/////////// 당월실적 목록 END ///////////
	
	/////////// 익월목표 목록 START ///////////
	// 추가 버튼 클릭
	scwin.btn_pln_add_onclick = function(e) {
		var row = com.addRow(grd_pln);
	};
	
	// 삭제 버튼 클릭
	scwin.btn_pln_del_onclick = function(e) {
		var rows = grd_pln.getCheckedIndex("chk");
		if(rows.length == 0){
			alert("삭제 할 행을 선택해 주십시오");
			return;
		}
			
		rows.reverse().forEach(function(row) {
			dlt_pln.removeRow(row);
		});
	};
	
	// 결재신청 버튼 클릭 시
	scwin.btn_apr_onclick = function(e) {
		// 저장 전에 validation 체크 진행
		if(!scwin.pre_save()) return;
		
		// 결재 신청일 경우 '당해년도' 실적인지 체크 후 SptTechSmnrReg.xml -> menuApproval()
		var today = com.getServerDateTime();
		var chk_val = today.substring(0,4) + "0101"
		if(dma_info.get("educ_start_ymd") <= chk_val){
			com.alert("당해년도 실적만 신청이 가능합니다. \n개최일자를 확인하여 주시기 바랍니다.");
			return;
		}
		// 첨부파일 필수 체크
		if(com.file.action.getTotalFileCount(upload_A.getID()) < 1){
			com.alert(com.getMsg("message.xom.co.com.0012", "첨부파일"));
			//com.alert("첨부파일을 확인해 주십시요!");
			return;
		}
	
		scwin.aprYn = "Y";
		dma_info.set("approval", "true");
		dma_info.set("cud_type", "S");
		scwin.cudType = "S";
		scwin.save(scwin.cudType);
	};
	/////////// 익월목표 목록 END ///////////
	
	// exceptionCallback
	scwin.exceptionCallback = function(resObj){
		var resultCd = gcm.sbm.getResCode(resObj);
		var msg = gcm.lang.getMsg(resultCd);
		var resJSON = resObj.responseJSON || null;
		var resultMsg = gcm.sbm.getResMsg(resObj); 
		
		if (gcm.util.isEmpty(msg) || msg == resultCd || msg.indexOf("{0}") != -1) { 
			// resultCd가 등록되지 않은 메시지 코드인 경우 resultMsg alert
			msg = resultMsg;
		}
		if (!com.isEmpty(resJSON.userHeader.errBusiness)) {
			msg = "["+ resJSON.userHeader.errBusiness +"] "+ msg;
		}
		if (resJSON.userHeader.errKind == "ALERT") {
			com.alert(msg);
		} else if (resJSON.userHeader.errKind == "ERROR") {
			com.error(msg);
		} else {
			com.warn(msg);
		}
	};
	
	// 인쇄 버튼 클릭 시
	scwin.btn_print_onclick = function(e) {
		var node = "req_no="+dma_info.get("req_no");
		com.oz.openPopup({
			ozrCode : "S672",      
			param: node
        });	
	};
	
	
	// AS-IS 스크립트 확인
	/*
	1. 삭제 성공시 : //TOP
	2. 상세조회 시 : <!-- 보고서 상세조회 -->
	2-1. 전자결재에서 호출시 참여기업 option 세팅 : msgSptTltRptInfo001  paramClsf = "1";
	2-2. 승인여부에 따라 권한(결재,저장,삭제) : if(aprState == "XAD070" || aprState == "XAD100"){ // 담당자 확인중 | 결재완료
	2-3. 조회 후 첨부파일 세팅 : attachFileNo_A = WebSquare.xml.getValue(dataXml, "msgSptTltRptInfo001/attach_file_no", "value");
	3. 참여기업 option 변경시 세팅 : <!-- 신규입력 시 기본조회 -->
	4. 저장 성공시 : <!-- 작성 내용 저장 -->
	4-1. 저장/결재시 메시지
	4-2. 저장 실패시 '98' 이면 동일월 작성중인 보고서.....
	5. onLoad 시 조회진행 : function Form_OnLoadCompleted(){
	5-1. 기업정보 호출 : regionCentrOnChange();
	5-2. 첨부파일 세팅 : KitechAttach.create('upload_A', {fileKey: ("" !== attachFileNo_A.trim()) ? attachFileNo_A.trim() : typeCode, mode: 'edit'});
	6. 저장 전 확인 : function preSave(){
	6-1. 결재시에는 첨부파일,당월실적 체크
	6-2. 저장(결재)시 참여기업,작성일자 체크
	7. 저장 실행 : function menuSave(){
	8. (상세)조회시 : function menuFind(){
	8-1. 전자결재에서 호출시 approval_clsf = Y else N 으로 세팅
	9. 행추가 : function menuAddRow(objGrid){
	10. 행삭제 : function menuDelRow(objGrid, objMsgId){
	11. 기업정보 호출 : function regionCentrOnChange(){
	12. 반려사유 보이기여부 : function setStylePosition(dispFlag){
	13. 삭제버튼 클릭 : function menuDelete() { / function menuDelectAttach(attachObj){
	14. 보고서 클릭 : // 보고서 인쇄
	15. 결재신청 버튼 클릭 : <xf:label>결재신청</xf:label>  cudType = "S";
	16. 목록 버튼 클릭 : <xf:label>목록</xf:label>
	17. 참여기업 option 변경시 : gfnExecuteSubmission("selectBaseResult");
	18. 반려정보 숨기기/보이기 버튼 클릭 : setStylePosition
	19. 저장 버튼 클릭 : cudType = "C";
	19. 삭제 버튼 클릭 : 
	*/
	]]></script>
    </head>
    <body ev:onpageload="scwin.onpageload" ev:onpageunload="scwin.onpageunload">
    	<w2:wframe id="wfm_title" src="/cm/xml/contentTitle.xml" style=""></w2:wframe>
    	<xf:group class="pageWrap" id="grp_docMain" style="">
    		<xf:group class="searchSection step" id="" style="">
    			<xf:group class="le" id="">
    				<xf:trigger class="btn " id="btn_list" style="" type="button" ev:onclick="scwin.btn_list_onclick">
    					<xf:label><![CDATA[목록]]></xf:label>
    				</xf:trigger>
    			</xf:group>
    			<xf:group class="btnbox" id="">
    				<xf:trigger class="btn icon print" id="btn_print" style="" type="button" ev:onclick="scwin.btn_print_onclick">
    					<xf:label><![CDATA[인쇄]]></xf:label>
    				</xf:trigger>
    				<xf:trigger class="btn blue" id="btn_apr" style="" type="button" ev:onclick="scwin.btn_apr_onclick">
    					<xf:label><![CDATA[결재신청]]></xf:label>
    				</xf:trigger>
    			</xf:group>
    		</xf:group>
    		<xf:group class="w2tb tbl" id="" style="" tagname="table">
    			<w2:attributes>
    				<w2:summary></w2:summary>
    			</w2:attributes>
    			<xf:group tagname="caption"></xf:group>
    			<xf:group tagname="colgroup">
    				<xf:group style="width:220px;" tagname="col"></xf:group>
    				<xf:group style="" tagname="col"></xf:group>
    				<xf:group style="width:220px;" tagname="col"></xf:group>
    				<xf:group style="" tagname="col"></xf:group>
    			</xf:group>
    			<xf:group tagname="tr">
    				<xf:group class="w2tb_th" tagname="th">
    					<w2:attributes>
    						<w2:scope>row</w2:scope>
    					</w2:attributes>
    					<w2:textbox class="" id="" label="보고서번호" style="" tagname="span"></w2:textbox>
    				</xf:group>
    				<xf:group class="w2tb_td" tagname="td">
    					<w2:attributes></w2:attributes>
    					<w2:textbox class="txt" id="tbx_req_no" label="000" style="" tagname="span" ref="data:dma_info.req_no"></w2:textbox>
    				</xf:group>
    				<xf:group class="w2tb_th" tagname="th">
    					<w2:attributes>
    						<w2:scope>row</w2:scope>
    					</w2:attributes>
    					<w2:textbox class="" id="" label="보고년월" style="" tagname="span"></w2:textbox>
    				</xf:group>
    				<xf:group class="w2tb_td" tagname="td">
    					<w2:attributes></w2:attributes>
    					<w2:inputCalendar calendarValueType="yearMonth" class="inpcal" focusOnDateSelect="false" footerDiv="false"
    						id="ica_rpt_yrmon" renderDiv="true" rightAlign="false" style="max-width: 200px;" ref="data:dma_info.rpt_yrmon">
    					</w2:inputCalendar>
    				</xf:group>
    			</xf:group>
    			<xf:group tagname="tr">
    				<xf:group class="w2tb_th" tagname="th">
    					<w2:attributes>
    						<w2:scope>row</w2:scope>
    					</w2:attributes>
    					<w2:textbox id="" label="참여기업" style="" tagname="span"></w2:textbox>
    				</xf:group>
    				<xf:group class="w2tb_td" tagname="td">
    					<w2:attributes></w2:attributes>
    					<xf:group class="flex" id="" style="">
	    					<xf:select1 allOption="" appearance="minimal" chooseOption="true" chooseOptionLabel="-선택-" class="sel fix"
	    						direction="auto" disabled="false" disabledClass="w2selectbox_disabled" id="sbx_cust_no" style="width: 200px;"
	    						submenuSize="auto" ev:onviewchange="scwin.sbx_cust_no_onviewchange">
	    						<xf:choices>
	    							<xf:itemset nodeset="data:dlt_cust">
	    								<xf:label ref="cmpy_nm_krchar"></xf:label>
	    								<xf:value ref="cust_no"></xf:value>
	    							</xf:itemset>
	    						</xf:choices>
	    					</xf:select1>
	    					<xf:input adjustMaxLength="false" class="inp full" id="" style="max-width:200px;" readOnly="true" ref="data:dma_info.cust_no"></xf:input>
    					</xf:group>
    				</xf:group>
    				<xf:group class="w2tb_th" tagname="th">
    					<w2:attributes>
    						<w2:scope>row</w2:scope>
    					</w2:attributes>
    					<w2:textbox id="" label="참여기업 대표자" style="" tagname="span"></w2:textbox>
    				</xf:group>
    				<xf:group class="w2tb_td" tagname="td">
    					<w2:attributes></w2:attributes>
    					<w2:textbox class="txt" id="" label="000" style="" tagname="span" ref="data:dma_info.reprs_psn"></w2:textbox>
    				</xf:group>
    			</xf:group>
    			<xf:group tagname="tr">
    				<xf:group class="w2tb_th" tagname="th">
    					<w2:attributes>
    						<w2:scope>row</w2:scope>
    					</w2:attributes>
    					<w2:textbox class="" id="" label="기업지원 연구인력 성명" style="" tagname="span"></w2:textbox>
    				</xf:group>
    				<xf:group class="w2tb_td" tagname="td">
    					<w2:attributes></w2:attributes>
    					<w2:textbox class="txt" id="" label="000" style="" tagname="span" ref="data:dma_info.nm"></w2:textbox>
    				</xf:group>
    				<xf:group class="w2tb_th" tagname="th">
    					<w2:attributes>
    						<w2:scope>row</w2:scope>
    					</w2:attributes>
    					<w2:textbox id="" label="직급" style="" tagname="span"></w2:textbox>
    				</xf:group>
    				<xf:group class="w2tb_td" tagname="td">
    					<w2:attributes></w2:attributes>
    					<w2:textbox class="txt" id="" label="000" style="" tagname="span" ref="data:dma_info.posi_nm"></w2:textbox>
    				</xf:group>
    			</xf:group>
    			<xf:group tagname="tr">
    				<xf:group class="w2tb_th" tagname="th">
    					<w2:attributes>
    						<w2:scope>row</w2:scope>
    					</w2:attributes>
    					<w2:textbox id="" label="첨부파일" style="" tagname="span"></w2:textbox>
    				</xf:group>
    				<xf:group class="w2tb_td" tagname="td">
    					<w2:attributes>
    						<w2:colspan>3</w2:colspan>
    						<w2:rowspan>1</w2:rowspan>
    					</w2:attributes>
    					<xf:group class="fileuploadBox" id="upload_A" style="height:150px;"></xf:group>
    				</xf:group>
    			</xf:group>
    		</xf:group>
    		<xf:group class="titleSection" id="" style="">
    			<xf:group class="le" id="">
    				<w2:textbox class="tit_tbl" escape="false" id="" label="당월실적" style="" tagname="h3"></w2:textbox>
    			</xf:group>
    			<xf:group class="ri" id="">
    				<xf:group class="btnarea" id="" style="">
    					<xf:trigger class="bt_plus" id="btn_rpt_add" style="" type="button" ev:onclick="scwin.btn_rpt_add_onclick">
    						<xf:label><![CDATA[추가]]></xf:label>
    					</xf:trigger>
    					<xf:trigger class="bt_minus" id="btn_rpt_del" style="" type="button" ev:onclick="scwin.btn_rpt_del_onclick">
    						<xf:label><![CDATA[삭제]]></xf:label>
    					</xf:trigger>
    				</xf:group>
    			</xf:group>
    		</xf:group>
    		 <w2:gridView autoFit="allColumn" class="grid" dataList="data:dlt_rpt" defaultCellHeight="28" evenRowBackgroundColor="#f7faff"
    			id="grd_rpt" noResultMessage="조회 결과가 없습니다." noResultMessageClass="noResult" noResultMessageStyle="display: block !important;"
    			rowMouseOverColor="#e7f0fb" rowNumBackgroundColor="#fff" rowNumHeaderValue="No." rowNumVisible="true" rowNumWidth="60"
    			rowStatusHeaderValue="상태" rowStatusVisible="false" rowStatusWidth="50" scrollByColumn="false" scrollByColumnAdaptive="false"
    			selectedCellColor="#fbf2cd" selectedRowColor="#fbf2cd" style="height: 85px;" visibleRowNum="10">
    			<w2:caption id="caption1" style="" value="this is a grid caption."></w2:caption>
    			<w2:header id="header1" style="">
    				<w2:row id="row1" style="">
    					<w2:column checkboxLabel="전체선택" displayMode="label" fixColumnWidth="true" id="column1" inputType="checkbox"
    						readOnly="false" style="height:28px;" value="선택" width="45">
    					</w2:column>
    					<w2:column displayMode="label" id="column9" inputType="text" style="height:28px;" value="구분" width="100"></w2:column>
    					<w2:column displayMode="label" id="column7" inputType="text" style="height:28px;" value="목표" width="300"></w2:column>
    					<w2:column displayMode="label" id="column5" inputType="text" style="height:28px;" value="실적" width="300"></w2:column>
    					<w2:column displayMode="label" id="column3" inputType="text" style="height:28px;" value="비고" width="200"></w2:column>
    				</w2:row>
    			</w2:header>
    			<w2:gBody id="gBody1" style="">
    				<w2:row id="row2" style="">
    					<w2:column checkboxLabel="선택" displayMode="label" id="chk" inputType="checkbox" readOnly="false"
    						style="height:28px;" width="50">
    					</w2:column>
    					<w2:column displayMode="label" id="that_month_div" inputType="text" style="height:28px;" width="100" editModeEvent="onclick" class="le" maxByteLength="250"></w2:column>
    					<w2:column displayMode="label" id="that_month_goal" inputType="text" style="height:28px;" width="300" editModeEvent="onclick" class="le" maxByteLength="1024"></w2:column>
    					<w2:column displayMode="label" escape="false" id="that_month_result" inputType="text" style="height:28px;"
    						width="300" editModeEvent="onclick" class="le" maxByteLength="1024">
    					</w2:column>
    					<w2:column displayMode="label" id="rmk" inputType="text" style="height:28px;" width="200" editModeEvent="onclick" class="le" maxByteLength="250"></w2:column>
    				</w2:row>
    			</w2:gBody>
    		</w2:gridView>
    		<xf:group class="titleSection" id="" style="">
    			<xf:group class="le" id="">
    				<w2:textbox class="tit_tbl" escape="false" id="" label="익월목표" style="" tagname="h3"></w2:textbox>
    			</xf:group>
    			<xf:group class="ri" id="">
    				<xf:group class="btnarea" id="" style="">
    					<xf:trigger class="bt_plus" id="btn_pln_add" style="" type="button" ev:onclick="scwin.btn_pln_add_onclick">
    						<xf:label><![CDATA[추가]]></xf:label>
    					</xf:trigger>
    					<xf:trigger class="bt_minus" id="btn_pln_del" style="" type="button" ev:onclick="scwin.btn_pln_del_onclick">
    						<xf:label><![CDATA[삭제]]></xf:label>
    					</xf:trigger>
    				</xf:group>
    			</xf:group>
    		</xf:group>
    		<w2:gridView autoFit="allColumn" class="grid" dataList="data:dlt_pln" defaultCellHeight="28" evenRowBackgroundColor="#f7faff"
    			id="grd_pln" noResultMessage="조회 결과가 없습니다." noResultMessageClass="noResult" noResultMessageStyle="display: block !important;"
    			rowMouseOverColor="#e7f0fb" rowNumBackgroundColor="#fff" rowNumHeaderValue="No." rowNumVisible="true" rowNumWidth="60"
    			rowStatusHeaderValue="상태" rowStatusVisible="false" rowStatusWidth="50" scrollByColumn="false" scrollByColumnAdaptive="false"
    			selectedCellColor="#fbf2cd" selectedRowColor="#fbf2cd" style="height: 85px;" visibleRowNum="10">
    			<w2:caption id="caption1" style="" value="this is a grid caption."></w2:caption>
    			<w2:header id="header1" style="">
    				<w2:row id="row1" style="">
    					<w2:column checkboxLabel="전체선택" displayMode="label" fixColumnWidth="true" id="column1" inputType="checkbox"
    						readOnly="false" style="height:28px;" value="선택" width="45">
    					</w2:column>
    					<w2:column displayMode="label" id="column9" inputType="text" style="height:28px;" value="구분" width="100"></w2:column>
    					<w2:column displayMode="label" id="column7" inputType="text" style="height:28px;" value="목표" width="600"></w2:column>
    					<w2:column displayMode="label" id="column3" inputType="text" style="height:28px;" value="비고" width="200"></w2:column>
    				</w2:row>
    			</w2:header>
    			<w2:gBody id="gBody1" style="">
    				<w2:row id="row2" style="">
    					<w2:column checkboxLabel="선택" displayMode="label" id="chk" inputType="checkbox" readOnly="false"
    						style="height:28px;" width="50">
    					</w2:column>
    					<w2:column displayMode="label" id="next_month_div" inputType="text" style="height:28px;" width="100" editModeEvent="onclick" class="le" maxByteLength="250"></w2:column>
    					<w2:column displayMode="label" id="next_month_goal" inputType="text" style="height:28px;" width="600" editModeEvent="onclick" class="le"></w2:column>
    					<w2:column displayMode="label" id="rmk" inputType="text" style="height:28px;" width="200" editModeEvent="onclick" class="le" maxByteLength="250"></w2:column>
    				</w2:row>
    			</w2:gBody>
    		</w2:gridView>
    		<xf:group class="titleSection" id="" style="">
    			<xf:group class="le" id=""></xf:group>
    			<xf:group class="ri" id="">
    				<xf:group class="btnarea" id="grp_gbt02" style="">
    					<xf:trigger class="bt_fold" id="btn_up" style="" type="button" ev:onclick="scwin.btn_up_onclick">
    						<xf:label><![CDATA[접기]]></xf:label>
    					</xf:trigger>
    					<xf:trigger class="bt_fold_on" id="btn_down" style="" type="button" ev:onclick="scwin.btn_down_onclick">
    						<xf:label><![CDATA[펼치기]]></xf:label>
    					</xf:trigger>
    				</xf:group>
    			</xf:group>
    		</xf:group>
    		<xf:group id="grp_reject_rmk">
    		<xf:group class="titleSection mt0" id="reject_rmk_head" style="">
    			<w2:textbox class="tit_tbl" id="" label="결제반려사유" style="" tagname="h3"></w2:textbox>
    		</xf:group>
    		<xf:group class="w2tb tbl" id="reject_rmk" style="" tagname="table">
    			<w2:attributes>
    				<w2:summary></w2:summary>
    			</w2:attributes>
    			<xf:group tagname="caption"></xf:group>
    			<xf:group tagname="colgroup">
    				<xf:group style="width:220px;" tagname="col"></xf:group>
    				<xf:group style="" tagname="col"></xf:group>
    			</xf:group>
    			<xf:group style="" tagname="tr">
    				<xf:group class="w2tb_th" tagname="th">
    					<w2:attributes>
    						<w2:scope>row</w2:scope>
    					</w2:attributes>
    					<w2:textbox id="" label="반려사유" style="" tagname="span"></w2:textbox>
    				</xf:group>
    				<xf:group class="w2tb_td" tagname="td">
    					<w2:attributes></w2:attributes>
    					<xf:textarea class="" id="" style="height:80px;" title="" ref="data:dma_info.rmk" maxByteLength="2028"></xf:textarea>
    				</xf:group>
    			</xf:group>
    		</xf:group>
    		</xf:group>
    		<xf:group class="btnGroup" id="grp_gbt03" style="">
    			<xf:group class="le" id="" style=""></xf:group>
    			<xf:group class="ri" id="">
    				<xf:trigger class="btn pro" id="btn_del" style="" type="button" ev:onclick="scwin.btn_del_onclick">
    					<xf:label><![CDATA[삭제]]></xf:label>
    				</xf:trigger>
    				<xf:trigger class=" btn pro conf" id="btn_save" style="" type="button" ev:onclick="scwin.btn_save_onclick">
    					<xf:label><![CDATA[저장]]></xf:label>
    				</xf:trigger>
    			</xf:group>
    		</xf:group>
    	</xf:group>
    </body>
</html>
