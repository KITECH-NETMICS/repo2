(function(){function A(f){return f.type==POLARIS.NODE_TEXT&&0<f.getLength()&&!f.isReadOnly()}function B(f){return!(f.type==POLARIS.NODE_ELEMENT&&f.isBlockBoundary(POLARIS.tools.extend({},POLARIS.dtd.$empty,POLARIS.dtd.$nonEditable)))}function u(f){function q(a,b){var c=this,d=new POLARIS.dom.walker(a);d.guard=b?B:function(a){!B(a)&&(c._.matchBoundary=!0)};d.evaluator=A;d.breakOnFalse=1;a.startContainer.type==POLARIS.NODE_TEXT&&(this.textNode=a.startContainer,this.offset=a.startOffset-1);this._={matchWord:b,
walker:d,matchBoundary:!1}}function v(a,b){var c=f.createRange(),d=a.textNode,m=f.editable();c.setStart(d,b?a.offset:a.offset+1);if(f.config.wordprocessor&&h){var l=h.length,g,n;for(g=0;g<l;g++)if(n=h[g],n.contains(d)){c.setEndAt(n,POLARIS.POSITION_BEFORE_END);break}c.endContainer||c.setEndAt(m,POLARIS.POSITION_BEFORE_END)}else c.setEndAt(m,POLARIS.POSITION_BEFORE_END);return c}function u(a){var b=[],c=0;if(a)for(var d=0;d<a.length;d++){var f=b,l='\x3cdiv style\x3d"text-align:left;"\x3e'+a[d]+"\x3c/div\x3e",
g=POLARIS.tools.getNextNumber();f.push('\x3ctr role\x3d"presentation"\x3e\x3ctd class\x3d"polaris_time_format_list_td" style\x3d"vertical-align: center;" role\x3d"presentation"\x3e\x3ca href\x3d"javascript:void(0)" role\x3d"option"',' aria-labelledby\x3d"'+g+'"',' class\x3d"polaris_list_item polaris_hand" tabindex\x3d"-1" header-footer-index\x3d"'+c+'"\x3e','\x3cspan id\x3d"'+g+'"\x3e'+l+"\x3c/span\x3e\x3c/a\x3e","\x3c/td\x3e\x3c/tr\x3e");c++}return b.join("")}function w(a){var b=[],c=[],d;if(f.config.wordprocessor){var m=
f.plugins.spellingcheck.getSearchContentOnly();d=f.pagination.getPageContainer(f.document);var l=f.pagination.getPages(d),g=l.count(),n,e;for(n=0;n<g;n++)d=l.getItem(n),e=m?d.body:d.owner,e.mergeTextNodes(),d=f.createRange(),d.setStartAt(e,POLARIS.POSITION_AFTER_START),d.setEndAt(e,POLARIS.POSITION_BEFORE_END),c.push(e),b.push(d)}else m=f.editable(),m.mergeTextNodes(),d=f.createRange(),d.setStartAt(m,POLARIS.POSITION_AFTER_START),d.setEndAt(m,POLARIS.POSITION_BEFORE_END),c.push(m),b.push(d);h=c;k.initSpellchecker(b,
POLARIS.filterDictionary)==k.FIND_MATCHED?r(a):(C(f),x(a),y=!1,a.hide())}function r(a){for(var b=k.searchRanges.length,c=k.currentSearchIndex;c<b;c++)if(k.find(c)==k.FIND_MATCHED){var c=k.getMatchWord(),b=a,d=k.filterDictionary[c];d&&(d=d.split(","),b.getContentElement("spellingcheck","txtFindSpelling").setValue(c),b.getContentElement("spellingcheck","txtChangeWord").setValue(d[0]),b.getContentElement("spellingcheck","txtSuggestWordContainer").getElement().setHtml(u(d)));z(a,!0);return}C(f);x(a);
y=!1;a.hide()}function C(a){(new POLARIS.plugins.notification(a,{message:e.checkComplete,type:"info",duration:1500,width:240,valign:"top",align:"center"})).show()}function x(a){k.clear();z(a,!1);a.getContentElement("spellingcheck","txtSuggestWordContainer").getElement().setHtml("")}function z(a,b){var c=a.getContentElement("spellingcheck","btnFindStartSkip"),d=a.getContentElement("spellingcheck","btnFindSkipContinue"),f=a.getContentElement("spellingcheck","btnReplace"),l=a.getContentElement("spellingcheck",
"btnReplaceAll");b?(c.getInputElement().getFirst().setHtml(e.findSkip),d.enable(),f.enable(),l.enable()):(c.getInputElement().getFirst().setHtml(e.findStart),d.disable(),f.disable(),l.disable())}var D=new POLARIS.style(POLARIS.tools.extend({attributes:{"data-polaris-highlight":1},fullMatch:1,ignoreReadonly:1,childRule:function(){return 0}},f.config.spellingcheck_highlight,!0));q.prototype={next:function(){return this.move()},back:function(){return this.move(!0)},move:function(a){var b=this.textNode;
if(null===b)return E.call(this);this._.matchBoundary=!1;if(b&&a&&0<this.offset)this.offset--;else if(b&&!a&&this.offset<b.getLength()-1)this.offset++;else{for(b=null;!b&&!(b=this._.walker[a?"previous":"next"].call(this._.walker),this._.matchWord&&!b||this._.walker._.end););this.offset=(this.textNode=b)?a?b.getLength()-1:0:0}return E.call(this)}};var t=function(a,b,c){this._={walker:a,cursors:[],rangeLength:b,highlightRange:null,isComplete:!1,matcher:c}};t.prototype={toDomRange:function(){var a=f.createRange(),
b=this._.cursors;if(1>b.length){var c=this._.walker.textNode;if(c)a.setStartAfter(c);else return null}else c=b[0],b=b[b.length-1],a.setStart(c.textNode,c.offset),a.setEnd(b.textNode,b.offset+1);return a},updateFromDomRange:function(a){var b=new q(a);this._.cursors=[];do a=b.next(),a.character&&this._.cursors.push(a);while(a.character);this._.rangeLength=this._.cursors.length},setComplete:function(a){this._.isComplete=a},isComplete:function(){return this._.isComplete},getMatcher:function(){return this._.matcher},
highlight:function(){if(!(1>this._.cursors.length)){this._.highlightRange&&this.removeHighlight();var a=this.toDomRange();D.applyToRange(a,f);this._.highlightRange=a;var b=a.startContainer;b.type!=POLARIS.NODE_ELEMENT&&(b=b.getParent());b.scrollIntoView();this.updateFromDomRange(a)}},removeHighlight:function(){this._.highlightRange&&(D.removeFromRange(this._.highlightRange,f),this.updateFromDomRange(this._.highlightRange),this._.highlightRange=null)},isReadOnly:function(){return this._.highlightRange?
this._.highlightRange.startContainer.isReadOnly():0},moveBack:function(){var a=this._.walker.back(),b=this._.cursors;a.hitMatchBoundary&&(this._.cursors=b=[]);b.unshift(a);b.length>this._.rangeLength&&b.pop();return a},moveNext:function(){var a=this._.walker.next(),b=this._.cursors;a.hitMatchBoundary&&(this._.cursors=b=[]);b.push(a);b.length>this._.rangeLength&&b.shift();return a},getEndCharacter:function(){var a=this._.cursors;return 1>a.length?null:a[a.length-1].character},getStartCharacter:function(){var a=
this._.cursors;return 1>a.length?null:a[0].character},getNextCharacterRange:function(a){var b,c;c=this._.cursors;c=(b=c[c.length-1])&&b.textNode?new q(v(b)):this._.walker;return new t(c,a,this._.matcher)},getBeforeCharacterRange:function(a){var b;if((b=this._.cursors[0])&&b.textNode){var c=f.createRange(),d=b.textNode,m=f.editable();if(f.config.wordprocessor&&h){var l=h.length,g,e;for(g=0;g<l;g++)if(e=h[g],e.contains(d)){c.setStartAt(e,POLARIS.POSITION_AFTER_START);break}c.startContainer||c.setStartAt(m,
POLARIS.POSITION_AFTER_START)}else c.setStartAt(m,POLARIS.POSITION_AFTER_START);c.setEnd(d,b.offset);b=new q(c)}else b=this._.walker;return new t(b,a,this._.matcher)},getCursors:function(){return this._.cursors}};var h,F=function(a,b){var c=[-1];b&&(a=a.toLowerCase());for(var d=0;d<a.length;d++)for(c.push(c[d]+1);0<c[d+1]&&a.charAt(d)!=a.charAt(c[d+1]-1);)c[d+1]=c[c[d+1]-1]+1;this._={overlap:c,state:0,ignoreCase:!!b,pattern:a}};F.prototype={feedCharacter:function(a){for(this._.ignoreCase&&(a=a.toLowerCase());;)return a==
this._.pattern.charAt(this._.state)?(this._.state++,this._.state==this._.pattern.length?(this._.state=0,2):1):0},reset:function(){this._.state=0}};var k={FIND_NOMATCH:0,FIND_MATCHED:1,filterDictionary:null,searchRanges:[],searchFilters:[],currentSearchIndex:0,ignoreWords:[],matchRange:null,clear:function(){var a=this.matchRange;a&&a.removeHighlight();this.searchRanges=[];this.searchFilters=[];this.currentSearchIndex=0;this.ignoreWords=[];this.matchRange=null},initSpellchecker:function(a,b){function c(a){a=
new POLARIS.dom.walker(a);a.breakOnFalse=1;a.evaluator=A;for(var b=[],c;c=a.next();)b.push(c.getText());return b.join("")}var d=k.FIND_NOMATCH,f=new RegExp(Object.keys(b).join("|"),"gi"),l=[],g=a.length,e,p,h;for(e=0;e<g;e++)p=a[e],p=c(p),h=[],p.replace(f,function(a){-1==h.indexOf(a)&&h.push(a);d=k.FIND_MATCHED;return a}),l.push(h.sort().reverse());this.filterDictionary=b;this.searchRanges=a;this.searchFilters=l;this.currentSearchIndex=0;return d},createCharacterRanges:function(a,b){var c=[],d=k.ignoreWords,
f=b.length,e,g,n,h;for(e=0;e<f;e++)g=b[e],-1<d.indexOf(g)||(h=new F(g,!0),n=new q(a),g=new t(n,g.length,h),c[c.length]=g);return c},find:function(a){this.currentSearchIndex=a;var b=this.matchRange;b?(b.removeHighlight(),b=b.getCursors(),b=v(b[b.length-1]),this.matchRange=null,a=this.createCharacterRanges(b,this.searchFilters[a])):a=this.createCharacterRanges(this.searchRanges[a],this.searchFilters[a]);for(var b=a.length,c,d,f,e,g,h,p;;){c=0;d=!0;for(f=0;f<b;f++)if(e=a[f],g=e.getMatcher(),p=!1,!e.isComplete()){for(e.moveNext();h=
e.getEndCharacter();){c=g.feedCharacter(h);if(2==c)break;else if(0==c){g.reset();p=!0;break}e.moveNext().hitMatchBoundary&&g.reset()}if(2==c)return this.matchRange=e,e.highlight(),k.FIND_MATCHED;1==p?d=!1:e.setComplete(!0)}if(d)return k.FIND_NOMATCH}},replace:function(a,b,c){var d=k.FIND_NOMATCH,e=this.matchRange,h=this.getMatchWord();e&&!e.isReadOnly()&&h==b&&(e.removeHighlight(),b=e.getCursors(),b=v(b[b.length-1]),b.trim(),b=(new q(b,!0)).next(),/ /.test(b.character)&&(d=b.textNode.getText().replace(/^ /g,
" "),b.textNode.setText(d)),b=e.toDomRange(),c=f.document.createText(c),b.deleteContents(),b.insertNode(c),e.updateFromDomRange(b),e.highlight(),d=k.FIND_MATCHED,r(a));return d},getMatchWord:function(){for(var a="",b=this.matchRange,c=b?b.getCursors():null,b=c?b.getCursors().length:0,d=0;d<b;d++)a+=c[d].character;return a}},e=f.lang.spellingcheck,y=!0;return{title:e.title,resizable:POLARIS.DIALOG_RESIZE_NONE,minWidth:244,minHeight:100,buttons:[POLARIS.dialog.cancelButton(f,{label:f.lang.common.close})],
contents:[{id:"spellingcheck",label:e.spellingcheck,elements:[{type:"hbox",children:[{type:"text",id:"txtFindSpelling",style:"width:172px",label:"",widths:[0,172],isChanged:!1,labelLayout:"horizontal",accessKey:"F",readOnly:!0},{type:"button",id:"btnFindStartSkip",align:"left",style:"width:66px",label:e.findStart,isChanged:!1,onClick:function(){var a=this.getDialog();a.getContentElement("spellingcheck","btnFindStartSkip").getElement().getText()==e.findStart?w(a):r(a)}}]},{type:"hbox",children:[{type:"text",
id:"txtChangeWord",style:"width:172px",widths:[54,118],label:e.changeWord,isChanged:!1,labelLayout:"horizontal"},{type:"button",id:"btnFindSkipContinue",align:"left",style:"width:66px",label:e.findSkipContinue,isChanged:!1,onClick:function(){var a=this.getDialog(),b=k.ignoreWords,c=k.getMatchWord();-1==b.indexOf(c)&&b.push(c);r(a)}}]},{type:"hbox",style:"width:244px",children:[{type:"hbox",style:"width:172px",widths:[54,118],children:[{type:"html",style:"width:54px",html:'\x3cspan style\x3d"width:52px"\x3e'+
e.sugesstWord+"\x3c/span\x3e"},{type:"html",style:"width:118px",id:"txtSuggestWordContainer",html:function(){var a=POLARIS.tools.getNextId()+"_suggest_word_label",a=['\x3cdiv class\x3d"polaris_spellingcheck_list_div"\x3e\x3cspan id\x3d"'+a+'" class\x3d"polaris_voice_label"\x3e'+e.headerfooter+"\x3c/span\x3e",'\x3ctable align\x3d"left" role\x3d"listbox" aria-labelledby\x3d"'+a+'" style\x3d"table-layout: fixed; border-collapse: collapse; border-spacing: 0;" cellpadding\x3d"1"',POLARIS.env.ie&&POLARIS.env.quirks?
' style\x3d"position:absolute;"':"","\x3e\x3ctbody\x3e"];a.push("\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e");return a.join("")}(),onClick:function(a){a=a.data.getTarget();"a"!==a.getName()&&(a=a.getAscendant("a"))&&this.getDialog().getContentElement("spellingcheck","txtChangeWord").setValue(a.getText())},style:"border-collapse: separate; overflow:auto;"}]},{type:"vbox",style:"width:68px",children:[{type:"button",id:"btnReplace",align:"left",style:"width:66px",label:e.replace,onClick:function(){var a=
this.getDialog(),b=a.getValueOf("spellingcheck","txtChangeWord"),c=a.getValueOf("spellingcheck","txtFindSpelling");0<b.length?k.replace(a,c,b)||alert(e.notFoundReplaceMsg):alert(e.inputFindComment)}},{type:"button",id:"btnReplaceAll",align:"left",style:"width:66px",label:e.replaceAll,onClick:function(){var a=this.getDialog(),b=a.getValueOf("spellingcheck","txtChangeWord"),c=a.getValueOf("spellingcheck","txtFindSpelling");b?k.replace(a,c,b,!0)||alert(e.notFoundReplaceMsg):alert(e.inputFindComment)}}]}]}]}],
onLoad:function(){},onShow:function(){z(this,!1);if(f.plugins.spellingcheck.getCheckStart()){var a=this.getContentElement("spellingcheck","txtFindSpelling");a.setValue("");a.select();var b=this;null==POLARIS.filterDictionary||void 0==POLARIS.filterDictionary?(a=[POLARIS.getUrl(this.path+"words/filterDictionary.js")],POLARIS.loadTemplates(a,function(){w(b)})):w(b)}},onHide:function(){var a;if(a=k.matchRange)a.removeHighlight(),f.focus(),(a=a.toDomRange())&&f.getSelection().selectRanges([a]);x(this);
h=null;f.fire("SpellCheckCompleted",{isSpellingCheckCancled:y})},onFocus:function(){return this.getContentElement("spellingcheck","txtFindSpelling")}}}var E=function(){return{textNode:this.textNode,offset:this.offset,character:this.textNode?this.textNode.getText().charAt(this.offset):null,hitMatchBoundary:this._.matchBoundary}};POLARIS.dialog.add("spellingcheck",function(f){return u(f,"spellingcheck")})})();