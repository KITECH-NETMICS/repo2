(function(){POLARIS.dialog.add("templates",function(a){function v(a){var b=POLARIS.dom.element.createFromHtml('\x3ca href\x3d"javascript:void(0)" tabIndex\x3d"-1" role\x3d"option" \x3e\x3cdiv class\x3d"polaris_template_item"\x3e'+a.title+"\x3c/div\x3e\x3c/a\x3e");b.on("click",function(){var b=[POLARIS.getUrl("plugins/templates/templates/form/"+a.filename)];POLARIS.loadTemplates(b,function(){x(k[a.templatename])})});return b}function x(w){var b=POLARIS.dialog.getCurrent();a.fire("saveSnapshot");a.setData(w,
function(){b.hide();if(a.config.wordprocessor)a.plugins.pagination.setInitialCaret(a,!1);else{var h=a.createRange();h.moveToElementEditStart(a.editable());h.select()}setTimeout(function(){a.fire("saveSnapshot")},0)})}function t(a){var b=a.data.getTarget(),h=g.equals(b);if(h||g.contains(b)){var f=a.data.getKeystroke(),d=g.getElementsByTag("a"),c;if(d){if(h)c=d.getItem(0);else switch(f){case 40:c=b.getNext();break;case 38:c=b.getPrevious();break;case 13:case 32:b.fire("click")}c&&(c.focus(),a.data.preventDefault())}}}
var e=POLARIS.plugins.get("templates");POLARIS.document.appendStyleSheet(POLARIS.getUrl(e.path+"dialogs/templates.css"));var k={};POLARIS.addTemplatesHTML=function(a,b){k[a]=b};var g,e="polaris_template_list_label_"+POLARIS.tools.getNextNumber(),m=a.lang.templates,u=a.config;return{title:a.lang.templates.title,minWidth:198,minHeight:150,resizable:POLARIS.DIALOG_RESIZE_NONE,contents:[{id:"selectTpl",label:m.title,elements:[{type:"vbox",children:[{id:"selectTplText",type:"html",html:""},{type:"vbox",
padding:0,children:[{id:"templatesListTitle",type:"html",html:"\x3cdiv\x3e\x3c/div\x3e"},{id:"templatesList",type:"html",focus:!0,html:'\x3cdiv class\x3d"polaris_template_list_div" tabIndex\x3d"-1" role\x3d"listbox" aria-labelledby\x3d"'+e+'"\x3e\x3c/div\x3e\x3cspan class\x3d"polaris_voice_label" id\x3d"'+e+'"\x3e'+m.options+"\x3c/span\x3e"}]}]}]}],buttons:[POLARIS.dialog.cancelButton(a,{label:a.lang.common.close})],onShow:function(){var a=this.getContentElement("selectTpl","templatesListTitle"),
b=this.getContentElement("selectTpl","templatesList");titleContainer=a.getElement();g=b.getElement();POLARIS.loadTemplates(u.templates_files,function(){var a=(u.templates||"default").split(",");if(a.length){var f=titleContainer;f.setHtml("");f.setHtml('\x3ctable style\x3d"table-layout: fixed;"\x3e\x3ctr\x3e\x3c/tr\x3e\x3c/table\x3e');f=g;f.setHtml("");for(var d='\x3ctable style\x3d"table-layout: fixed;"\x3e\x3ctr\x3e',c=0,e=a.length;c<e;c++)d+='\x3ctd class\x3d"polaris_template_list_td"\x3e\x3c/td\x3e';
for(var d=POLARIS.dom.element.createFromHtml(d+"\x3c/tr\x3e\x3c/table\x3e"),n=d.getFirst().getLast().getFirst(),c=0,e=a.length;c<e;c++){var k=POLARIS.getTemplates(a[c]).templates,p=k.length,q=POLARIS.dom.element.createFromHtml("\x3cdiv\x3e\x3c/div\x3e");if(0<p)for(var l=0;l<p;l++){var r=v(k[l]);r.setAttribute("aria-posinset",l+1);r.setAttribute("aria-setsize",p);q.append(r)}else q.setAttribute("class","polaris_template_item_empty");n.append(q);n=n.getNext()}f.append(d);b.focus()}else g.setHtml('\x3cdiv class\x3d"polaris_template_empty"\x3e\x3cspan\x3e'+
m.emptyListMsg+"\x3c/span\x3e\x3c/div\x3e")});this._.element.on("keydown",t)},onHide:function(){this._.element.removeListener("keydown",t)}}})})();