(function(){var w=function(c,m){function w(){var b=arguments,a=this.getContentElement("advanced","txtdlgGenStyle");a&&a.commit.apply(a,b);this.foreach(function(a){a.commit&&"txtdlgGenStyle"!=a.id&&a.commit.apply(a,b)})}function q(b){if(!x){x=1;var a=this.getDialog(),e=a.imageElement;if(e){this.commit(1,e);b=[].concat(b);for(var c=b.length,g,f=0;f<c;f++)(g=a.getContentElement.apply(a,b[f].split(":")))&&g.setup(1,e)}x=0}}var r=/^\s*(\d+)[.]*(\d*)((px)|\%)?\s*$/i,C=/(^\s*(\d+)((px)|\%)?\s*$)|^$/i,t=
/^\d+px$/,y=/data:image\/.*;base64/g,g,u=function(){var b=this.getValue(),a=this.getDialog(),e=b.match(r);e&&(b=e[1]);a.lockRatio&&(e=a.originalElement,"true"==e.getCustomData("isReady")&&("txtHeight"==this.id?(b&&"0"!=b&&(b=Math.round(b/e.$.height*e.$.width)),isNaN(b)||a.setValueOf("info","txtWidth",b)):(b&&"0"!=b&&(b=Math.round(b/e.$.width*e.$.height)),isNaN(b)||a.setValueOf("info","txtHeight",b))));h(a)},h=function(b){if(!b.originalElement||!b.preview)return 1;b.commitContent(4,b.preview);return 0},
x,z=function(b,a){var e=b.getContentElement("info","ratioLock");if(!e)return null;var c=b.originalElement;if(!c)return null;"check"==a?b.userlockRatio||"true"!=c.getCustomData("isReady")||(b.lockRatio=!0):void 0!==a?b.lockRatio=a:(b.userlockRatio=1,b.lockRatio=!b.lockRatio);e.setValue(b.lockRatio);return b.lockRatio},D=function(b){var a=b.originalElement;if("true"==a.getCustomData("isReady")){var e=b.getContentElement("info","txtWidth"),c=b.getContentElement("info","txtHeight");e&&e.setValue(a.$.width);
c&&c.setValue(a.$.height)}h(b)},n=function(b,a){function e(a,b){var c=a.match(r);return c?c[1]:b}if(1==b){this.getDialog();var c="",f="txtWidth"==this.id?"width":"height",g=a.getAttribute(f);g&&(c=e(g,c));c=e(a.getStyle(f),c);this.setValue(c)}},A,v=function(){var b=this.originalElement,a=POLARIS.document.getById(p);b.setCustomData("isReady","true");b.removeListener("load",v);b.removeListener("error",k);b.removeListener("abort",k);a&&a.setStyle("display","none");this.dontResetSize||D(this);this.firstLoad&&
POLARIS.tools.setTimeout(function(){z(this,"check")},0,this);this.dontResetSize=this.firstLoad=!1;h(this)},k=function(){var b=this.originalElement,a=POLARIS.document.getById(p);b.removeListener("load",v);b.removeListener("error",k);b.removeListener("abort",k);b=POLARIS.getUrl(POLARIS.plugins.get("image").path+"images/noimage.png");this.preview&&this.preview.setAttribute("src",b);a&&a.setStyle("display","none");z(this,!1)},B=function(b,a){a||(a=POLARIS.dialog.getCurrent().getContentElement("info",
"txtPath"));a&&(b.match(y)?a.getInputElement().setAttribute("disabled",!0):a.getInputElement().removeAttribute("disabled"),a.setValue(b))};c.on("imgPathChanged",function(b){g=b.data;B(g)});var f=function(b){return POLARIS.tools.getNextId()+"_"+b};f("btnLockSizes");f("btnResetSize");var p=f("ImagePreviewLoader"),l=f("previewLink"),E=f("previewImage"),n={title:c.lang.image["image"==m?"title":"titleButton"],minWidth:244,minHeight:110,resizable:POLARIS.DIALOG_RESIZE_NONE,onShow:function(){g=null;this.dontResetSize=
this.linkEditMode=this.imageEditMode=this.linkElement=this.imageElement=!1;this.firstLoad=!0;this.addLink=!1;var b=this.getParentEditor(),a=b.getSelection(),c=(a=a&&a.getSelectedElement())&&b.elementPath(a).contains("a",1),d=POLARIS.document.getById(p);d&&d.setStyle("display","none");A=new POLARIS.dom.element("img",b.document);this.preview=POLARIS.document.getById(E);this.originalElement=b.document.createElement("img");this.originalElement.setAttribute("alt","");this.originalElement.setCustomData("isReady",
"false");if(c){this.linkElement=c;this.linkEditMode=!0;d=c.getChildren();if(1==d.count()){var f=d.getItem(0).getName();if("img"==f||"input"==f)this.imageElement=d.getItem(0),"img"==this.imageElement.getName()?this.imageEditMode="img":"input"==this.imageElement.getName()&&(this.imageEditMode="input")}"image"==m&&this.setupContent(2,c)}if(this.customImageElement)this.imageEditMode="img",this.imageElement=this.customImageElement,delete this.customImageElement;else if(a&&"img"==a.getName()&&!a.data("polaris-realelement")||
a&&"input"==a.getName()&&"image"==a.getAttribute("type"))this.imageEditMode=a.getName(),this.imageElement=a;this.imageEditMode?(this.cleanImageElement=this.imageElement,this.imageElement=this.cleanImageElement.clone(!0,!0),this.setupContent(1,this.imageElement)):this.imageElement=b.document.createElement("img");!POLARIS.tools.trim(this.getValueOf("info","txtPath"))&&this.preview&&(this.preview.removeAttribute("src"),this.preview.setStyle("display","none"))},onOk:function(){c.pagination&&c.pagination.adjustCaret(c);
if(this.imageEditMode){var b=this.imageEditMode;"image"==m&&"input"==b&&confirm(c.lang.image.button2Img)?(this.imageElement=c.document.createElement("img"),this.imageElement.setAttribute("alt",""),c.insertElement(this.imageElement)):"image"!=m&&"img"==b&&confirm(c.lang.image.img2Button)?(this.imageElement=c.document.createElement("input"),this.imageElement.setAttributes({type:"image",alt:""}),c.insertElement(this.imageElement)):(this.imageElement=this.cleanImageElement,delete this.cleanImageElement)}else"image"==
m?this.imageElement=c.document.createElement("img"):(this.imageElement=c.document.createElement("input"),this.imageElement.setAttribute("type","image")),this.imageElement.setAttribute("alt","");this.linkEditMode||(this.linkElement=c.document.createElement("a"));this.commitContent(1,this.imageElement);this.commitContent(2,this.linkElement);this.imageElement.getAttribute("style")||this.imageElement.removeAttribute("style");this.imageEditMode?!this.linkEditMode&&this.addLink?(c.insertElement(this.linkElement),
this.imageElement.appendTo(this.linkElement)):this.linkEditMode&&this.addLink?this.imageElement.appendTo(this.linkElement):this.linkEditMode&&!this.addLink&&(c.getSelection().selectElement(this.linkElement),c.insertElement(this.imageElement)):this.addLink?this.linkEditMode?c.insertElement(this.imageElement):(c.insertElement(this.linkElement),this.linkElement.append(this.imageElement,!1)):c.insertElement(this.imageElement)},onLoad:function(){if("image"!=m){var b=this.getContentElement("advanced","linkOption"),
a=this.getContentElement("info","imageSizeOption");b&&(b=b.getElement().getParent().getParent(),b.hide());a&&(a=a.getElement().getParent().getParent(),a.hide())}this._.element.getDocument();this.commitContent=w},onHide:function(){c.execCommand("clearFilePicker");this.preview&&this.commitContent(8,this.preview);this.originalElement&&(this.originalElement.removeListener("load",v),this.originalElement.removeListener("error",k),this.originalElement.removeListener("abort",k),this.originalElement.remove(),
this.originalElement=!1);delete this.imageElement},contents:[{id:"info",label:c.lang.common.generalTab,accessKey:"I",elements:[{type:"hbox",children:[{id:"txtPath",type:"text",style:"width: 172px;",label:c.lang.image.imagePath,required:!0,onChange:function(){var b=this.getDialog(),a=this.getValue(),e="";a.match(y)&&(a=g);a=c.hasListeners("apis.onChangeFileUrl")?e=c.fire("apis.onChangeFileUrl",{url:a}):{url:a};a&&void 0!==a.url&&0<a.url.length?g!==a.url?(g=a.url,B(g,this)):(b=this.getDialog(),a=b.originalElement,
b.preview&&b.preview.removeStyle("display"),a.setCustomData("isReady","false"),(e=POLARIS.document.getById(p))&&e.setStyle("display",""),a.on("load",v,b),a.on("error",k,b),a.on("abort",k,b),a.setAttribute("src",g),b.preview&&(A.setAttribute("src",g),b.preview.setAttribute("src",A.$.src),h(b))):b.preview&&(b.preview.removeAttribute("src"),b.preview.setStyle("display","none"))},setup:function(b,a){if(1==b){var c=a.data("polaris-saved-src")||a.getAttribute("src");this.getDialog().dontResetSize=!0;g=
c;B(c,this);this.setInitValue()}},onShow:function(b){this.getValue().match(y)?this.getInputElement().setAttribute("disabled",!0):this.getInputElement().removeAttribute("disabled")},commit:function(b,a){var e=g;1==b&&(e||this.isChanged())?(c.getCommand("showImageBorder").state==POLARIS.TRISTATE_OFF?(a.addClass("polaris_img_border"),a.data("polaris-saved-src",e)):a.setAttribute("src",e),a.setAttribute("ondragstart","return false")):8==b&&(a.setAttribute("src",""),a.removeAttribute("src"))},validate:function(){var b=
POLARIS.dialog.validate.notEmpty(c.lang.image.urlMissing).apply(this);return!0===b?"false"==this.getDialog().originalElement.getCustomData("isReady")?(this.onChange(),!1):!0:b}},{type:"vbox",filebrowser:"uploadButton",label:c.lang.image.upload,style:"width: 66px;",children:[{type:"file",id:"upload",style:"width:100%",hidden:!0,label:c.lang.image.btnUpload,size:38},{type:"fileButton",id:"uploadButton",style:"width:100%",filebrowser:"info:txtPath",label:c.lang.image.btnUpload,"for":["info","upload"]}]}]},
{id:"txtImgTitle",type:"text",label:c.lang.image.imgTitle,hidden:!0,"default":"",onChange:function(){h(this.getDialog())},setup:function(b,a){1==b&&this.setValue(a.getAttribute("title"))},commit:function(b,a){1==b?(this.getValue()||this.isChanged())&&a.setAttribute("title",this.getValue()):4==b?a.setAttribute("title",this.getValue()):8==b&&a.removeAttribute("title")}},{type:"hbox",requiredContent:"img{width,height}",children:[{type:"text",id:"txtWidth",style:"width:78px;","default":c.config.defaultAdjustImageSize,
maxLength:3,label:c.lang.common.width,onKeyUp:u,onChange:function(){q.call(this,"advanced:txtdlgGenStyle")},validate:function(){var b=this.getValue().match(C),a=!(!b||0===parseInt(b[1],10));a?(a=this.getValue(),b=POLARIS.tools.getContentSizeToUnit(c,"px").width,a=!!(0<a&&a<b),a||(alert(c.lang.div.invalidWidth.replace("%1",b-1)),this.setValue(b-1),this.select(),u.call(this))):alert(c.lang.common.invalidWidth);return a},setup:n,commit:function(b,a,e){var d=this.getValue();1==b?(d&&c.activeFilter.check("img{width,height}")?
a.setStyle("width",POLARIS.tools.cssLength(d)):a.removeStyle("width"),!e&&a.removeAttribute("width")):4==b?d.match(r)?a.setStyle("width",POLARIS.tools.cssLength(d)):(b=this.getDialog().originalElement,"true"==b.getCustomData("isReady")&&a.setStyle("width",b.$.width+"px")):8==b&&(a.removeAttribute("width"),a.removeStyle("width"))}},{type:"vbox",children:[{type:"html",html:"\x26nbsp;"},{type:"html",html:c.lang.common.unitPx}]},{type:"text",id:"txtHeight",style:"width:78px;",label:c.lang.common.height,
maxLength:3,"default":c.config.defaultAdjustImageSize,onKeyUp:u,onChange:function(){q.call(this,"advanced:txtdlgGenStyle")},validate:function(){var b=this.getValue().match(C);if(b=!(!b||0===parseInt(b[1],10))){var a=this.getValue();if(c.config.wordprocessor){var e=POLARIS.tools.getContentSizeToUnit(c,"px").height,b=!!(0<a&&a<e);b||(alert(c.lang.div.invalidHeight.replace("%1",e-1)),this.setValue(e-1),this.select(),u.call(this))}}else alert(c.lang.common.invalidHeight);return b},setup:n,commit:function(b,
a,e){var d=this.getValue();1==b?(d&&c.activeFilter.check("img{width,height}")?a.setStyle("height",POLARIS.tools.cssLength(d)):a.removeStyle("height"),!e&&a.removeAttribute("height")):4==b?d.match(r)?a.setStyle("height",POLARIS.tools.cssLength(d)):(b=this.getDialog().originalElement,"true"==b.getCustomData("isReady")&&a.setStyle("height",b.$.height+"px")):8==b&&(a.removeAttribute("height"),a.removeStyle("height"))}},{type:"vbox",children:[{type:"html",html:"\x26nbsp;"},{type:"html",html:c.lang.common.unitPx}]}]},
{type:"hbox",id:"marginBox",children:[{type:"text",id:"txtHSpace",style:"width:78px;",maxLength:2,requiredContent:"img{margin-left,margin-right}",label:c.lang.image.hSpace,"default":"0",onKeyUp:function(){h(this.getDialog())},onChange:function(){q.call(this,"advanced:txtdlgGenStyle")},validate:POLARIS.dialog.validate.integer(c.lang.image.validateHSpace),setup:function(b,a){if(1==b){var c,d;c=a.getStyle("margin-left");d=a.getStyle("margin-right");c=c&&c.match(t);d=d&&d.match(t);c=parseInt(c,10);d=
parseInt(d,10);c=c==d&&c;isNaN(parseInt(c,10))&&(c=a.getAttribute("hspace")?c:0);this.setValue(c)}},commit:function(b,a,c){var d=parseInt(this.getValue(),10);1==b||4==b?(isNaN(d)?!d&&this.isChanged()&&(a.removeStyle("margin-left"),a.removeStyle("margin-right")):(a.setStyle("margin-left",POLARIS.tools.cssLength(d)),a.setStyle("margin-right",POLARIS.tools.cssLength(d))),c||1!=b||a.removeAttribute("hspace")):8==b&&(a.removeAttribute("hspace"),a.removeStyle("margin-left"),a.removeStyle("margin-right"))}},
{type:"vbox",children:[{type:"html",html:"\x26nbsp;"},{type:"html",html:c.lang.common.unitPx}]},{type:"text",id:"txtVSpace",style:"width:78px;",maxLength:2,requiredContent:"img{margin-top,margin-bottom}",label:c.lang.image.vSpace,"default":"0",onKeyUp:function(){h(this.getDialog())},onChange:function(){q.call(this,"advanced:txtdlgGenStyle")},validate:POLARIS.dialog.validate.integer(c.lang.image.validateVSpace),setup:function(b,a){if(1==b){var c,d;c=a.getStyle("margin-top");d=a.getStyle("margin-bottom");
c=c&&c.match(t);d=d&&d.match(t);c=parseInt(c,10);d=parseInt(d,10);c=c==d&&c;isNaN(parseInt(c,10))&&(c=a.getAttribute("vspace")?c:0);this.setValue(c)}},commit:function(b,a,c){var d=parseInt(this.getValue(),10);1==b||4==b?(isNaN(d)?!d&&this.isChanged()&&(a.removeStyle("margin-top"),a.removeStyle("margin-bottom")):(a.setStyle("margin-top",POLARIS.tools.cssLength(d)),a.setStyle("margin-bottom",POLARIS.tools.cssLength(d))),c||1!=b||a.removeAttribute("vspace")):8==b&&(a.removeAttribute("vspace"),a.removeStyle("margin-top"),
a.removeStyle("margin-bottom"))}},{type:"vbox",children:[{type:"html",html:"\x26nbsp;"},{type:"html",html:c.lang.common.unitPx}]}]},{type:"hbox",id:"imageSizeOption",children:[{id:"ratioLock",type:"checkbox",style:"padding-left: 10px;",label:c.lang.image.lockRatio,"default":!1,onClick:function(){var b=this.getDialog();z(b);var a=b.originalElement,c=b.getValueOf("info","txtWidth");"true"==a.getCustomData("isReady")&&c&&(a=a.$.height/a.$.width*c,isNaN(a)||(b.setValueOf("info","txtHeight",Math.round(a)),
h(b)))}},{type:"button",id:"btnResetSize",style:"width:118px",label:c.lang.image.resetSize,onClick:function(){D(this.getDialog())}}]}]},{id:"advanced",hidden:!0,label:c.lang.common.advancedTab,elements:[{type:"vbox",id:"linkOption",children:[{type:"html",html:"\x3cp\x3e"+c.lang.image.linkTab+"\x3c/p\x3e"},{type:"vbox",requiredContent:"a[href]",style:"border: 1px solid #a0a2ab; border-radius: 2px; background-color: #f4f5f7; padding: 4px 10px; height:84px;",children:[{id:"txtUrl",type:"text",label:c.lang.image.linkPath,
validate:function(b){return function(){var a=this.getValue(),c=/^((?:http|https|ftp|news):\/\/)?(.*)$/,d=!0,f;a&&(f=a.match(c))&&!f[1]&&(alert(b),this.select(),d=!1);return d}}(c.lang.image.invalidLink),style:"width: 100%;","default":"",setup:function(b,a){if(2==b){var c=a.getAttribute("href");this.setValue(c)}},commit:function(b,a){if(2==b&&(this.getValue()||this.isChanged())){var e=this.getValue();a.setAttribute("href",e);if(this.getValue()||!c.config.image_removeLinkByEmptyURL)this.getDialog().addLink=
!0}}},{id:"cmbTarget",type:"select",requiredContent:"a[target]",label:c.lang.common.target,"default":"",items:[[c.lang.common.notSet,""],[c.lang.common.targetNew,"_blank"],[c.lang.common.targetTop,"_top"],[c.lang.common.targetSelf,"_self"],[c.lang.common.targetParent,"_parent"]],setup:function(b,a){2==b&&this.setValue(a.getAttribute("target")||"")},commit:function(b,a){2==b&&(this.getValue()||this.isChanged())&&a.setAttribute("target",this.getValue())}}]}]},{type:"text",id:"linkId",requiredContent:"img[id]",
label:c.lang.common.id,setup:function(b,a){1==b&&this.setValue(a.getAttribute("id"))},commit:function(b,a){1==b&&(this.getValue()||this.isChanged())&&a.setAttribute("id",this.getValue())}},{id:"cmbLangDir",type:"select",requiredContent:"img[dir]",label:c.lang.common.langDir,"default":"",items:[[c.lang.common.notSet,""],[c.lang.common.langDirLtr,"ltr"],[c.lang.common.langDirRtl,"rtl"]],setup:function(b,a){1==b&&this.setValue(a.getAttribute("dir"))},commit:function(b,a){1==b&&(this.getValue()||this.isChanged())&&
a.setAttribute("dir",this.getValue())}},{type:"html",id:"htmlPreview",style:"width:100%",html:"\x3cdiv\x3e"+POLARIS.tools.htmlEncode(c.lang.common.preview)+'\x3cbr\x3e\x3cdiv id\x3d"'+p+'" class\x3d"ImagePreviewLoader" style\x3d"display:none"\x3e\x3cdiv class\x3d"loading"\x3e\x26nbsp;\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"ImagePreviewBox"\x3e\x3ctable\x3e\x3ctr\x3e\x3ctd\x3e\x3ca href\x3d"javascript:void(0)" target\x3d"_blank" onclick\x3d"return false;" id\x3d"'+l+'"\x3e\x3cimg id\x3d"'+E+'" alt\x3d"" /\x3e\x3c/a\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3c/div\x3e\x3c/div\x3e'}]}]};
if(c.config.useDocConvertServer&&c.config.docConvertingUrl)for(f=n.contents[0].elements,l=0;l<f.length;l++)if(f[l].id&&"marginBox"===f[l].id){f=f.splice(l,1);break}return n};POLARIS.dialog.add("image",function(c){return w(c,"image")});POLARIS.dialog.add("imagebutton",function(c){return w(c,"imagebutton")})})();