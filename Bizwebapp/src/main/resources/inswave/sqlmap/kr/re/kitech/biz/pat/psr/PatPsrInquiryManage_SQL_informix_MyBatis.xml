<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper      
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"      
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.re.kitech.biz.pat.psr">
<update id="updatePatmastrBpmYnSU01" parameterType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo">
/* XDA : kitech.pat.com.xda.PatmastrBpmYnSU01 bpm_yn update query */
UPDATE /* QueryID : kr.re.kitech.biz.pat.psr.updatePatmastrBpmYnSU01 */ 
		  patmastr set
bpm_yn = #{bpm_yn}
WHERE mngmt_no = #{mngmt_no}
  </update>
<select id="selectPatPsrBasicInfoSS03" parameterType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo" resultType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo">
/* XDA : kitech.pat.psr.xda.PatPsrBasicInfoSS03 지재권 신고서 정보 조회 다건*/
SELECT /* QueryID : kr.re.kitech.biz.pat.psr.selectPatPsrBasicInfoSS03 */ 
		 pam.req_no
      , pam.invnt_krn_nm
      , pam.co_smitapp_ex
      , (CASE WHEN pam.co_smitapp_ex = 'Y'
               THEN '공동'
               ELSE '단독'
         END) AS co_smitapp_ex_nm
      , TRIM(pam.invnt_draft_ymd) AS invnt_draft_ymd
      , TRIM(pam.invnt_syspayno) AS invnt_syspayno
      , hbi.nm AS invnt_syspaynm
      , pam.invnt_apprvl_complt_ymd
FROM patappmastr pam
      LEFT JOIN humbasicinfo hbi
         ON hbi.syspayno = pam.invnt_syspayno
WHERE 1 = 1
AND pam.req_no = #{req_no}
  </select>
<select id="selectPatPsrBasicInfoSS04" parameterType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo" resultType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo">
/* XDA : kitech.pat.psr.xda.PatPsrBasicInfoSS04 지재권 공동업체 정보 조회 다건*/
SELECT /* QueryID : kr.re.kitech.biz.pat.psr.selectPatPsrBasicInfoSS04 */ 
		 pcsv.seq
      , pcsv.vend_type
      , (CASE WHEN pcsv.vend_type = '1'
               THEN '사업자'
               ELSE '개인'
         END) AS vend_type_nm
      , pcsv.vend_cd
      , pcsv.vend_nm
      , pcsv.vend_bsn_no
      , pcsv.charg
      , pcsv.addr
      , pcsv.contac_loc
      , pcsv.stake_rt
FROM patcosmitappvend pcsv
WHERE 1 = 1
AND pcsv.req_no = #{req_no}
AND pcsv.mngmt_no = #{mngmt_no}
  </select>
<select id="selectPatPsrBasicInfoSS02" parameterType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo" resultType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo">
/* XDA : kitech.pat.psr.xda.PatPsrBasicInfoSS02 지재권 담당자정보 조회 단건*/
SELECT /* QueryID : kr.re.kitech.biz.pat.psr.selectPatPsrBasicInfoSS02 */ 
		 pm.req_no
     , pm.mngmt_no
     , pci.syspayno AS invnt_syspayno
     , hbi1.nm AS invnt_nm
     , pm.mandate_psn_syspayno
     , hbi2.nm AS mandate_psn_nm
     , pm.patofic_cd
     , po1.patofic_nm
     , pm.keep_mngmt_offc
     , po2.patofic_nm AS keep_mngmt_offc_nm
     , pm.patofic_charg_id
     , poc.nm AS patofic_charg_nm
FROM patmastr pm
      LEFT JOIN patcoinvntpsn pci
          ON pci.req_no = pm.req_no
          AND pci.mngmt_no = pm.mngmt_no
          AND pci.invnt_psn_clsf = '1'
      LEFT JOIN humbasicinfo hbi1
          ON hbi1.syspayno = pci.syspayno
      LEFT JOIN humbasicinfo hbi2
          ON hbi2.syspayno = pm.mandate_psn_syspayno
      LEFT JOIN patoffice po1
          ON po1.patofic_cd = pm.patofic_cd
      LEFT JOIN patoffice po2
          ON po2.patofic_cd = pm.keep_mngmt_offc
      LEFT JOIN patoficcharg poc
          ON poc.id = pm.patofic_charg_id
WHERE 1 = 1
AND pm.req_no = #{req_no}
AND pm.mngmt_no = #{mngmt_no}
  </select>
<select id="selectPatPsrLst01" parameterType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo" resultType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo">
/* XDA : kitech.pat.psr.xda.PatPsrLst01 지재권 목록 조회 다건*/
SELECT /* QueryID : kr.re.kitech.biz.pat.psr.selectPatPsrLst01 */ 
		 pm.req_no
      , pm.mngmt_no
      , pm.pat_clsf
      , xdc2.cd_nm AS pat_clsf_nm
      , pm.invnt_krn_nm
      , pip2.syspayno AS invnt_syspayno
      , pm.invnt_syspayno AS main_invnt_syspayno
      , hbi.nm AS invnt_psn_nm
      , hbi2.nm AS main_invnt_psn_nm
      , hbi2.empno AS main_invnt_empno
      , pm.dom_oversea_clsf
      , xdi.dept_nm AS invnt_dept_nm
      , pm.smitapp_no
      , pm.smitapp_ymd
      , pm.regst_no
      , pm.regst_ymd
      , pcm.cd_desc AS smitapp_natn_nm
      , pm.state
      , CASE SUBSTR(pm.state, 0, 3) WHEN 'P14' THEN poa.cnt || '차 ' || ps.state_desc
                                       WHEN 'P15' THEN poa.cnt || '차 ' ||  ps.state_desc
                                       ELSE ps.state_desc END AS state_nm
      , xdi.dept_typ
      , xdc1.cd_nm AS dept_typ_nm
      , fun_pat_relatreschprj_lst(pm.req_no) AS accnt_no
      , pof.patofic_nm
      , (CASE WHEN tr.mngmt_no IS NOT NULL
              THEN '유'
              ELSE '무'
         END) AS trans_yn
      , decode(nvl(ppe.mngmt_no,''),'','','우수') AS eval_grade_val
      ,xdc3.cd_nm AS pat_grd_nm
      ,nvl(pam.interview_yn,'N') AS interview_yn
      ,decode(pm.dom_oversea_clsf,'PNT010','국내','국외') as dom_oversea_nm
      ,pam.demand_vend_nm
      ,CASE
        WHEN pm.state = 'P9000' AND xdc4.cd_nm IS NULL
        THEN "포기"
        ELSE xdc4.cd_nm
        END  giveup_knd_nm
      , pm.invnt_eng_nm
FROM patmastr pm
      LEFT JOIN patoffice pof
         ON pof.patofic_cd = pm.patofic_cd
      LEFT JOIN patcoinvntpsn pip
         ON pip.req_no = pm.req_no
         AND pip.mngmt_no = pm.mngmt_no
      LEFT JOIN patcoinvntpsn pip2
         ON pip2.req_no = pm.req_no
         AND pip2.mngmt_no = pm.mngmt_no
         AND pip2.invnt_psn_clsf = '1'
      LEFT JOIN humbasicinfo hbi2
         ON hbi2.syspayno = pm.invnt_syspayno
      LEFT JOIN xodhdeptinfo xdi2
         ON xdi2.dept_cd = hbi2.dept_cd
         AND xdi2.dept_new_ymd = hbi2.dept_new_ymd
      LEFT JOIN xodxcommst xdc5
         ON xdc5.cd = xdi2.dept_typ
      LEFT JOIN humbasicinfo hbi
         ON hbi.syspayno = pip2.syspayno
      LEFT JOIN xodhdeptinfo xdi
         ON xdi.dept_cd = hbi.dept_cd
         AND xdi.dept_new_ymd = hbi.dept_new_ymd
      LEFT JOIN xodxcommst xdc1
         ON xdc1.cd = xdi.dept_typ
      LEFT JOIN patcodemastr pcm
         ON pcm.cd_nm = pm.smitapp_natn_cd
         AND grp_clsf        = '1'
         AND up_cd_no        = '000392'
         AND del_yn          = 'N'
      LEFT JOIN xodxcommst xdc2
         ON xdc2.cd = pm.pat_clsf
      LEFT JOIN patstatecode ps
         ON ps.state_cd = pm.state
      LEFT JOIN (
         SELECT rr.mngmt_no
              , COUNT(1)   AS rr_cnt
         FROM respstaply rr
         WHERE 1 = 1
         AND NVL(rr.mngmt_no,'') != ''
         GROUP BY rr.mngmt_no    
      ) tr ON tr.mngmt_no = pm.mngmt_no
      LEFT JOIN (
        select mngmt_no 
        from    patposteval
        where   eval_grade  <![CDATA[ >= ]]>  0  and eval_grade  <![CDATA[ <= ]]>  3
        group by mngmt_no
      ) ppe ON ppe.mngmt_no = pm.mngmt_no
LEFT JOIN (SELECT mngmt_no, COUNT(oa_id) AS cnt FROM patoa GROUP BY mngmt_no) poa ON poa.mngmt_no = pm.mngmt_no
INNER JOIN patappmastr pam ON pam.req_no=pm.req_no
LEFT OUTER JOIN xodxcommst xdc3 ON xdc3.cd = pam.pat_grd  AND xdc3.cd_clsf ='PPG'
LEFT JOIN patgiveup pgu ON pgu.mngmt_no = pm.mngmt_no
LEFT JOIN xodxcommst xdc4 ON xdc4.cd = pgu.giveup_knd AND xdc4.cd_clsf = 'PCG'
<where>
  <if test="invnt_psn_syspayno != null and invnt_psn_syspayno == ''">
    AND pip.invnt_psn_clsf = '1'
  </if>
  <if test="ref_no != null and ref_no != '' and no_type == 'A'.toString()">
    AND pm.req_no LIKE '%'|| #{ref_no} || '%'
  </if>
  <if test="ref_no != null and ref_no != '' and no_type == 'B'.toString()">
    AND pm.mngmt_no LIKE '%'|| #{ref_no} || '%'
  </if>
  <if test="ref_no != null and ref_no != '' and no_type == 'C'.toString()">
    AND pm.smitapp_no LIKE '%'|| #{ref_no} || '%'
  </if>
  <if test="ref_no != null and ref_no != '' and no_type == 'D'.toString()">
    AND pm.regst_no LIKE '%'|| #{ref_no} || '%'
  </if>
  <if test="ref_no != null and ref_no != '' and no_type == 'E'.toString()">
    AND pm.patofic_mng_no LIKE '%'|| #{ref_no} || '%'
  </if>
  <if test="start_date != null and start_date != '' and date_type == 'A'.toString()">
    AND pm.smitapp_ymd <![CDATA[ >= ]]> #{start_date}
  </if>
  <if test="start_date != null and start_date != '' and date_type == 'B'.toString()">
    AND pm.regst_ymd <![CDATA[ >= ]]> #{start_date}
  </if>
  <if test="start_date != null and start_date != '' and date_type == 'C'.toString()">
    AND pm.invnt_apprvl_complt_ymd <![CDATA[ >= ]]> #{start_date}
  </if>
  <if test="end_date != null and end_date != '' and date_type == 'A'.toString()">
    AND pm.smitapp_ymd <![CDATA[ <= ]]>  #{end_date}
  </if>
  <if test="end_date != null and end_date != '' and date_type == 'B'.toString()">
    AND pm.regst_ymd <![CDATA[ <= ]]> #{end_date}
  </if>
  <if test="end_date != null and end_date != '' and date_type == 'C'.toString()">
    AND pm.invnt_apprvl_complt_ymd <![CDATA[ <= ]]> #{end_date}
  </if>
  <if test="pat_clsf != null and pat_clsf != ''">
    AND pm.pat_clsf = #{pat_clsf}
  </if>
  <if test="smitapp_natn_nm != null and smitapp_natn_nm != ''">
    AND (pcm.cd_nm LIKE '%' || #{smitapp_natn_nm} || '%' OR pcm.cd_desc LIKE '%' || #{smitapp_natn_nm} || '%')
  </if>
  <if test="invnt_krn_nm != null and invnt_krn_nm != ''">
    AND pm.invnt_krn_nm LIKE '%' || #{invnt_krn_nm} || '%'
  </if>
  <if test="invnt_psn_syspayno != null and invnt_psn_syspayno != ''">
    AND pip.syspayno = #{invnt_psn_syspayno}
  </if>
  <if test="main_invnt_psn_syspayno != null and main_invnt_psn_syspayno != ''">
    AND pm.invnt_syspayno = #{main_invnt_psn_syspayno}
  </if>
  <if test="state != null and state != ''">
    AND ps.job_cd = #{state}
  </if>
  <if test="dept_typ != null and dept_typ != ''">
    AND xdi.dept_typ = #{dept_typ}
  </if>
  <if test="accnt_no != null and accnt_no != ''">
    AND fun_pat_relatreschprj_lst(pm.req_no) LIKE '%'|| #{accnt_no} ||'%'
  </if>
  <if test="dom_oversea_clsf != null and dom_oversea_clsf != ''">
    AND pm.dom_oversea_clsf =  #{dom_oversea_clsf}
  </if>
  <if test="trans_yn != null and trans_yn != '' and trans_yn == 'Y'.toString()">
    AND NVL(tr.mngmt_no, '') != ''
  </if>
  <if test="trans_yn != null and trans_yn != '' and trans_yn == 'N'.toString()">
    AND NVL(tr.mngmt_no, '') = ''
  </if>
  <if test="eval_grade_yn != null and eval_grade_yn != ''">
    AND decode(nvl(ppe.mngmt_no,'N'),'N','N','Y')=#{eval_grade_yn}
  </if>
</where>
GROUP BY 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21 ,22 ,23 ,24 ,25, 26, 27, 28, 29, 30, 31
  </select>
<select id="selectPatPsrBasicInfoSS05" parameterType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo" resultType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo">
/* XDA : kitech.pat.psr.xda.PatPsrBasicInfoSS05 지재권 공동 발명자 정보 조회 다건*/
SELECT /* QueryID : kr.re.kitech.biz.pat.psr.selectPatPsrBasicInfoSS05 */ 
		 pci.req_no
      , pci.mngmt_no
      , pci.seq
      , pci.syspayno
      , substr(pci.syspayno,3,8) AS empno
      , pci.blong_clsf
      , xdc.cd_nm AS blong_clsf_nm
      , pci.blong_cd
      , pci.blong_nm
      , pci.nm_krn
      , pci.email
      , pci.stake_rt
      , TRIM(pci.invnt_psn_clsf) AS invnt_psn_clsf
      , pci.stake_dept
      , pci.contac_loc
FROM patcoinvntpsn pci
      LEFT JOIN xodxcommst xdc
         ON xdc.cd = pci.blong_clsf
WHERE 1 = 1
AND pci.req_no = #{req_no}
AND pci.mngmt_no = #{mngmt_no}
  </select>
<select id="selectPatPsrBasicInfoSS01" parameterType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo" resultType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo">
/* XDA : kitech.pat.psr.xda.PatPsrBasicInfoSS01 지재권 기본 정보 조회 단건*/
-- 2018.03.09. 변경신청 신규생성으로 charg_syspayno 추가
SELECT /* QueryID : kr.re.kitech.biz.pat.psr.selectPatPsrBasicInfoSS01 */ 
		 pm.req_no
     , pm.mngmt_no
     , pm.pat_clsf
     , xdc1.cd_nm AS pat_clsf_nm
     , pm.state
     , ps.state_desc AS state_nm
     , pm.patofic_mng_no
     , pm.smitapp_natn_cd
     , pcm.cd_desc AS smitapp_natn_nm
     , pm.tech_clsf
     , xdc2.cd_nm AS tech_clsf_nm
     , pm.right_expir_ymd 
     , pm.smitapp_occr_clsf
     , xdc3.cd_nm AS smitapp_occr_clsf_nm
     , pm.smitapp_no
     , pm.smitapp_ymd
     , pm.regst_no
     , pm.regst_ymd
     , pm.invnt_krn_nm
     , pm.invnt_eng_nm
     , pm.bef_open_yn
     , pm.ely_open_ex
     , pm.eval_demnd_ex
     , pm.prity_eval_ex
     , pm.open_attach_file_no
     , pm.relat_dom_smitapp_no
     , pm.intrn_smitapp_no
     , pm.intrn_smitapp_ymd
     , pm.regst_reg_ymd
     , pm.smitapp_reg_ymd
     , pm.prityrgt_main_rspns_no
     , pm.prityrgt_main_rspns_ymd
     , pm.bpm_yn
     , pm.charg_syspayno
     , pg1.giveup_req_no
FROM patmastr pm
LEFT JOIN xodxcommst xdc1 ON xdc1.cd = pm.pat_clsf
LEFT JOIN xodxcommst xdc2 ON xdc2.cd = pm.tech_clsf
LEFT JOIN xodxcommst xdc3 ON xdc3.cd = pm.smitapp_occr_clsf
LEFT JOIN patstatecode ps ON ps.state_cd = pm.state
LEFT JOIN patcodemastr pcm ON pcm.cd_nm = pm.smitapp_natn_cd
LEFT JOIN patgiveup pg1 ON pm.mngmt_no = pg1.mngmt_no
WHERE pm.req_no = #{req_no}
AND   ('' = #{mngmt_no} OR pm.mngmt_no = #{mngmt_no})
  </select>
<select id="selectPatPsrBasicInfoSS07" parameterType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo" resultType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo">
/* XDA : kitech.pat.psr.xda.PatPsrBasicInfoSS07 지재권 우선권 주장 선출원 목록 정보 조회 다건*/
SELECT /* QueryID : kr.re.kitech.biz.pat.psr.selectPatPsrBasicInfoSS07 */ 
		 ppsa.req_no
      , ppsa.mngmt_no
      , ppsa.syspayno
      , ppsa.smitapp_no  
      , ppsa.smitapp_ymd
      , ppsa.invnt_krn_nm
      , ppsa.nm
FROM patprioritysmitapp ppsa
WHERE 1 = 1
AND ppsa.dp_clsf = 'PPT030'
AND ppsa.pr_req_no = #{req_no}
AND ppsa.pr_mngmt_no = #{mngmt_no}
  </select>
<select id="selectPatPsrBasicInfoSS06" parameterType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo" resultType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo">
/* XDA : kitech.pat.psr.xda.PatPsrBasicInfoSS06 지재권 연구과제 목록 정보 조회 다건*/
SELECT /* QueryID : kr.re.kitech.biz.pat.psr.selectPatPsrBasicInfoSS06 */ 
		 prp.req_no
      , prp.accnt_no
      , prp.prj_no 
      , prp.prj_nm
      , prp.resch_respn_syspayno
      , hbi.nm AS resch_respn_syspaynm
      , prp.prj_term
      , fun_xodxcommst_cd_nm(t2.bsns_cd_inout, 0)  AS bsns_cd_inout_nm
FROM patrelatreschprj prp
INNER JOIN resinpmast t2 ON prp.prj_no = t2.prj_no
      LEFT JOIN humbasicinfo hbi
         ON hbi.syspayno = prp.resch_respn_syspayno
WHERE 1 = 1
AND prp.req_no = #{req_no}
  </select>
<select id="selectPatPsrAppInfoSS02" parameterType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo" resultType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo">
/* XDA : kitech.pat.psr.xda.PatPsrAppInfoSS02 지재권 출원 업무이력 다건*/
SELECT /* QueryID : kr.re.kitech.biz.pat.psr.selectPatPsrAppInfoSS02 */ 
		 '선행기술조사' AS gb_nm
      , 'A' AS gb
      , ps.srh_id AS ref_key
      , hbi.nm AS manager_nm
      , xhi.dept_nm AS manager_deptnm
      , TO_CHAR(ps.fnsh_daytm,'%Y%m%d') AS compt_date
      , (CASE WHEN NVL(ps.fnsh_daytm,'') != ''
               THEN 'Y'
               ELSE 'N'
         END) AS comp_yn
      , '' AS bigo
FROM patsrh ps
      LEFT JOIN humbasicinfo hbi
        ON hbi.syspayno = ps.req_psn_syspayno
      LEFT JOIN xodhdeptinfo xhi
        ON xhi.dept_cd = hbi.dept_cd
        AND xhi.dept_new_ymd = hbi.dept_new_ymd
WHERE 1 = 1
AND ps.req_no = #{req_no}
AND ps.mngmt_no = #{mngmt_no}
UNION ALL
SELECT '발명자인터뷰' AS gb_nm
      , 'B' AS gb
      , pe.exam_id AS ref_key
      , hbi.nm AS manager_nm
      , xhi.dept_nm AS manager_deptnm
      , TO_CHAR(pe.fnsh_daytm,'%Y%m%d') AS compt_date
      , (CASE WHEN NVL(pe.fnsh_daytm,'') != ''
              THEN 'Y'
              ELSE 'N'
         END) AS comp_yn
      , '회차:' || pe.exam_year || '-' ||  TO_CHAR(pe.exam_cnt) AS bigo
FROM patexamobj peo
      INNER JOIN patexam pe
         ON pe.exam_id = peo.exam_id
      LEFT JOIN humbasicinfo hbi
        ON hbi.syspayno = pe.updt_syspayno
      LEFT JOIN xodhdeptinfo xhi
        ON xhi.dept_cd = hbi.dept_cd
        AND xhi.dept_new_ymd = hbi.dept_new_ymd
WHERE 1 = 1
AND pe.exam_clsf = 'I'
AND peo.req_no = #{req_no}
AND peo.mngmt_no = #{mngmt_no}
UNION ALL
SELECT '소연심의' AS gb_nm
      , 'C' AS gb
      , pe.exam_id AS ref_key
      , hbi.nm AS manager_nm
      , xhi.dept_nm AS manager_deptnm
      , TO_CHAR(pe.fnsh_daytm,'%Y%m%d') AS compt_date
      , (CASE WHEN NVL(pe.fnsh_daytm,'') != ''
              THEN 'Y'
              ELSE 'N'
         END) AS comp_yn
      , '회차:' || pe.exam_year || '-' ||  TO_CHAR(pe.exam_cnt) AS bigo
FROM patexamobj peo
      INNER JOIN patexam pe
         ON pe.exam_id = peo.exam_id
      LEFT JOIN humbasicinfo hbi
        ON hbi.syspayno = pe.updt_syspayno
      LEFT JOIN xodhdeptinfo xhi
        ON xhi.dept_cd = hbi.dept_cd
        AND xhi.dept_new_ymd = hbi.dept_new_ymd
WHERE 1 = 1
AND pe.exam_clsf = 'S'
AND peo.req_no = #{req_no}
AND peo.mngmt_no = #{mngmt_no}
UNION ALL
SELECT '지심의' AS gb_nm
      , 'D' AS gb
      , pe.exam_id AS ref_key
      , hbi.nm AS manager_nm
      , xhi.dept_nm AS manager_deptnm
      , TO_CHAR(pe.fnsh_daytm,'%Y%m%d') AS compt_date
      , (CASE WHEN NVL(pe.fnsh_daytm,'') != ''
              THEN 'Y'
              ELSE 'N'
         END) AS comp_yn
      , '회차:' || pe.exam_year || '-' ||  TO_CHAR(pe.exam_cnt) AS bigo
FROM patexamobj peo
      INNER JOIN patexam pe
         ON pe.exam_id = peo.exam_id
      LEFT JOIN humbasicinfo hbi
        ON hbi.syspayno = pe.updt_syspayno
      LEFT JOIN xodhdeptinfo xhi
        ON xhi.dept_cd = hbi.dept_cd
        AND xhi.dept_new_ymd = hbi.dept_new_ymd
WHERE 1 = 1
AND pe.exam_clsf = 'J'
AND peo.req_no = #{req_no}
AND peo.mngmt_no = #{mngmt_no}
UNION ALL
SELECT '소연심의' AS gb_nm
      , 'C' AS gb
      ,  b.req_no AS ref_key
      , h.nm AS manager_nm
      , xhi.dept_nm AS manager_deptnm
      , b.rvew_ymd AS compt_date
      , CASE 
            WHEN c.apr_state = 'XAD100' 
            THEN 'Y' 
            ELSE 'N' 
             END AS comp_yn
      , '회차:' ||b.rvew_yr || '-' ||  TO_CHAR(b.rvew_seq) AS bigo
FROM ressmlrvewd a
JOIN ressmlrvewh b ON a.req_no = b.req_no
LEFT JOIN xomxintfatab c ON b.elecapp_docu_no = c.req_no
LEFT JOIN humbasicinfo h ON b.updt_syspayno = h.syspayno
LEFT JOIN xodhdeptinfo xhi ON xhi.dept_cd = h.dept_cd AND xhi.dept_new_ymd = h.dept_new_ymd
WHERE 1 = 1
AND a.key_1 = #{req_no}
AND a.key_2 = #{mngmt_no}
UNION ALL
SELECT '지심의' AS gb_nm
      , 'D' AS gb
      , a.req_no AS ref_key
      , h.nm AS manager_nm
      , x.dept_nm AS manager_deptnm
      , TO_CHAR(NVL(a.updt_daytm,a.regst_daytm),'%Y%m%d') AS compt_date
      , (CASE WHEN b.apr_state = 'XAD100' 
              THEN 'Y'
              ELSE 'N'
         END) AS comp_yn
      , '회차:' || TO_CHAR(ah.rvew_seq) AS bigo
FROM ressuperrvewd a
LEFT JOIN xomxintfatab b ON b.req_no = a.key_1
JOIN ressmlrvewh ah ON a.req_no = ah.req_no
LEFT JOIN humbasicinfo h ON h.syspayno = ah.updt_syspayno
LEFT JOIN xodhdeptinfo x  ON x.dept_cd = h.dept_cd AND x.dept_new_ymd = h.dept_new_ymd
WHERE 1 = 1
AND a.key_1 = #{req_no}
AND a.key_2 = #{mngmt_no}
UNION ALL
SELECT '명세서작성' AS gb_nm
      , 'E' AS gb
      , ps.spec_id AS ref_key
      , fn_ofic_user_nm(ps.rcpt_charg_psn_id) AS manager_nm
      , pof.patofic_nm AS manager_deptnm
      , TO_CHAR(ps.fnsh_daytm,'%Y%m%d') AS compt_date
      , (CASE WHEN NVL(ps.fnsh_daytm,'') != ''
              THEN 'Y'
              ELSE 'N'
         END) AS comp_yn
      , '' AS bigo
FROM patspec ps
LEFT JOIN patoffice pof ON pof.patofic_cd = ps.req_patofic_cd
WHERE 1 = 1
AND ps.req_no = #{req_no}
AND ps.mngmt_no = #{mngmt_no}
UNION ALL
SELECT '출원지시' AS gb_nm
      , 'F' AS gb
      , pa.app_id AS ref_key
      , fn_ofic_user_nm(pa.rcpt_charg_psn_id) AS manager_nm
      , pof.patofic_nm AS manager_deptnm
      , TO_CHAR(pa.fnsh_daytm,'%Y%m%d') AS compt_date
      , (CASE WHEN NVL(pa.fnsh_daytm,'') != ''
              THEN 'Y'
              ELSE 'N'
         END) AS comp_yn
      , '' AS bigo
FROM patapp pa
LEFT JOIN patoffice pof ON pof.patofic_cd = pa.com_patofic_cd
WHERE 1 = 1
AND pa.req_no = #{req_no}
AND pa.mngmt_no = #{mngmt_no}
UNION ALL
SELECT 'IDS제출' AS gb_nm
      , 'G' AS gb
      , pi.ids_id AS ref_key
      , fn_ofic_user_nm(pi.rcpt_charg_psn_id) AS manager_nm
      , pof.patofic_nm AS manager_deptnm
      , TO_CHAR(pi.fnsh_daytm,'%Y%m%d') AS compt_date
      , (CASE WHEN NVL(pi.fnsh_daytm,'') != ''
              THEN 'Y'
              ELSE 'N'
         END) AS comp_yn
      , '' AS bigo
FROM patids pi
LEFT JOIN patoffice pof ON pof.patofic_cd = pi.rcpt_patofic_cd
WHERE 1 = 1
AND pi.req_no = #{req_no}
AND pi.mngmt_no = #{mngmt_no}
UNION ALL
SELECT '번역제출' AS gb_nm
      , 'H' AS gb
      , pt.trans_id AS ref_key
      , fn_ofic_user_nm(pt.rcpt_charg_psn_id) AS manager_nm
      , pof.patofic_nm AS manager_deptnm
      , TO_CHAR(pt.fnsh_daytm,'%Y%m%d') AS compt_date
      , (CASE WHEN NVL(pt.fnsh_daytm,'') != ''
              THEN 'Y'
              ELSE 'N'
         END) AS comp_yn
      , '' AS bigo
FROM pattrans pt
LEFT JOIN patoffice pof ON pof.patofic_cd = pt.rcpt_patofic_cd
WHERE 1 = 1
AND pt.req_no = #{req_no}
AND pt.mngmt_no = #{mngmt_no}
  </select>
<select id="selectPatPsrBasicInfoSS08" parameterType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo" resultType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo">
/* XDA : kitech.pat.psr.xda.PatPsrBasicInfoSS08 지재권 분할 선출원 목록 정보 조회 다건*/
SELECT /* QueryID : kr.re.kitech.biz.pat.psr.selectPatPsrBasicInfoSS08 */ 
		 ppsa.req_no
      , ppsa.mngmt_no
      , ppsa.syspayno
      , ppsa.smitapp_no  
      , ppsa.smitapp_ymd
      , ppsa.invnt_krn_nm
      , ppsa.nm
FROM patprioritysmitapp ppsa
WHERE 1 = 1
AND ppsa.dp_clsf = 'PPT040'
AND ppsa.pr_req_no = #{req_no}
AND ppsa.pr_mngmt_no = #{mngmt_no}
  </select>
<select id="selectPatAppMastrSS02" parameterType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo" resultType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo">
/* XDA : kitech.pat.dft.xda.PatAppMastrSS02 발명신고서 결재완료 후 처리로직 단건*/
SELECT /* QueryID : kr.re.kitech.biz.pat.psr.selectPatAppMastrSS02 */ 
		 a.req_no
     , a.pat_clsf 
     , a.invnt_clsf
     , a.dom_oversea_clsf
     , a.charg_syspayno AS chrg_psn
     , a.invnt_krn_nm AS rvew_objct
     , a.interview_yn
     , a.invnt_syspayno AS syspayno
     , a.co_smitapp_ex
     , NVL(a.pdp_flag,'N') AS pdp_flag
     , b.accnt_no
FROM patappmastr a
LEFT JOIN patapprelatreschprj b ON a.req_no = b.req_no
WHERE a.req_no = #{req_no}
  </select>
<select id="selectPatPsrAppInfoSS01" parameterType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo" resultType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo">
/* XDA : kitech.pat.psr.xda.PatPsrAppInfoSS01 지재권 출원완료보고 정보 조회 단건*/
SELECT /* QueryID : kr.re.kitech.biz.pat.psr.selectPatPsrAppInfoSS01 */ 
		 pa.app_id
      , pa.req_no
      , pa.mngmt_no
      , pa.prt_app_no
      , pa.prt_app_date
      , pa.prt_indep_cnt
      , pa.prt_depen_cnt
      , pa.prt_spec_cnt
      , pa.prt_draw_cnt
      , pa.prt_ko_app_title
      , pa.prt_en_app_title
      , pa.prt_app_attach_file
      , pa.prt_attach_file
      , pat.smitapp_reg_ymd
FROM patapp pa
INNER JOIN patmastr pat ON pat.mngmt_no = pa.mngmt_no
WHERE 1 = 1
AND pa.req_no = #{req_no}
AND pa.mngmt_no = #{mngmt_no}
  </select>
<update id="updatePatAppReqSU01" parameterType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo">
/* XDA : kitech.pat.app.req.xda.PatAppReqSU01 출원 데이터 변경  */
UPDATE /* QueryID : kr.re.kitech.biz.pat.psr.updatePatAppReqSU01 */ 
		 patapp
SET prt_app_attach_file = #{prt_app_attach_file},
    prt_indep_cnt = #{prt_indep_cnt},
    prt_depen_cnt = #{prt_depen_cnt},
    prt_spec_cnt = #{prt_spec_cnt},
    prt_draw_cnt =#{prt_draw_cnt},
    updt_syspayno = #{updt_syspayno},
    updt_daytm = CURRENT
WHERE mngmt_no = #{mngmt_no}
  </update>
<update id="updatePatmastrSU01" parameterType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo">
/* XDA : kitech.pat.psr.xda.PatmastrSU01 출원실적년월 저장 */
update /* QueryID : kr.re.kitech.biz.pat.psr.updatePatmastrSU01 */ 
		 patmastr set
smitapp_reg_ymd = #{smitapp_reg_ymd}
where req_no=#{req_no}
and mngmt_no=#{mngmt_no}
  </update>
<select id="selectResSmlRvewDSI01" parameterType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo" resultType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo">
/* XDA : kitech.res.app.xda.ResSmlRvewDSI01 소연심위 안건등록 */
-- 2018.04.17. sub_biz_clsf 추가
MERGE /* QueryID : kr.re.kitech.biz.pat.psr.selectResSmlRvewDSI01 */ 
		 INTO ressmlrvewd AS a
USING dual AS b ON 1=1 AND a.key_1 = #{key_1} AND a.key_2 = #{key_2}
WHEN MATCHED THEN
   UPDATE 
   SET a.biz_clsf = #{biz_clsf}
     , a.sub_biz_clsf = #{sub_biz_clsf}
     , a.item_clsf = #{item_clsf}
     , a.rvew_objct = #{rvew_objct}
     , a.syspayno = #{syspayno}
     , a.accnt_no = #{accnt_no}
     , a.chrg_psn = #{chrg_psn}
     , a.rmk = #{rmk}
     , a.cmt_clsf = #{cmt_clsf}
     , a.attach_file_no = #{attach_file_no}
     , a.updt_syspayno = #{regst_syspayno}
     , a.updt_daytm = CURRENT
WHEN NOT MATCHED THEN
   INSERT ( a.key_1   
          , a.key_2
          , a.biz_clsf
          , sub_biz_clsf
          , a.item_clsf
          , a.rvew_objct  
          , a.syspayno
          , a.accnt_no  
          , a.chrg_psn  
          , a.rmk
          , a.cmt_clsf  -- G(총괄위), P(지심위)
          , a.attach_file_no
          , a.regst_syspayno  
          , a.regst_daytm  )
   VALUES(#{key_1},#{key_2},#{biz_clsf},#{sub_biz_clsf},#{item_clsf},#{rvew_objct},#{syspayno},#{accnt_no},#{chrg_psn},#{rmk},#{cmt_clsf},#{attach_file_no},#{regst_syspayno},SYSDATE)
  </select>
<select id="selectPatPsrRegInfoSS01" parameterType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo" resultType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo">
/* XDA : kitech.pat.psr.xda.PatPsrRegInfoSS01 지재권 등록 정보 조회 단건*/
SELECT /* QueryID : kr.re.kitech.biz.pat.psr.selectPatPsrRegInfoSS01 */ 
		 pr.reg_id 
      , pr.req_no
      , pr.mngmt_no 
      , decode(pat.state,'P2000',prt_reg_no,pat.regst_no) AS prt_reg_no
      , NVL(prt_reg_date,pat.regst_reg_ymd) AS prt_reg_date
      , decode(pat.state,'P2000',pr.prt_indep_cnt,pat.prt_indep_cnt) AS prt_indep_cnt
      , decode(pat.state,'P2000',pr.prt_depen_cnt,pat.prt_depen_cnt) AS prt_depen_cnt
      , decode(pat.state,'P2000',pr.prt_spec_cnt,pat.prt_spec_cnt) AS prt_spec_cnt
      , decode(pat.state,'P2000',pr.prt_draw_cnt,pat.prt_draw_cnt) AS prt_draw_cnt
      , decode(pat.state,'P2000',pr.prt_ko_reg_title,pat.regst_krn_nm) AS prt_ko_reg_title
      , decode(pat.state,'P2000',pr.prt_en_reg_title,pat.regst_eng_nm) AS prt_en_reg_title
      , pr.prt_regist_attach_file
      , pr.prt_reg_org_attach_file
      , pr.prt_reg_attach_file
      , DECODE(NVL(pat.regst_reg_ymd,''),'',pr.eval_year_month, pat.regst_reg_ymd) AS regst_reg_ymd
      , pr.prt_attach_file
FROM patreg pr
INNER JOIN patmastr pat ON pat.req_no=pr.req_no AND pat.mngmt_no=pr.mngmt_no
WHERE 1 = 1
AND pr.req_no = #{req_no}
AND pr.mngmt_no = #{mngmt_no}
  </select>
<select id="selectPatCasTechTransMS01" parameterType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo" resultType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo">
/* XDA : kitech.pat.chr.xda.PatCasTechTransMS01 사건조회 - 기술이전 조회 다건*/
SELECT /* QueryID : kr.re.kitech.biz.pat.psr.selectPatCasTechTransMS01 */ 
		  d.tech_fee_clsf,
        k.first_pre_prj_no,
        a.smitapp_no,
        fun_xodxcommst_cd_nm(d.tech_fee_mou_state, 0) AS mou_state_nm,
        d.tech_fee_no,
        h.vend_nm,
        d.tech_nm,           
        c.accnt_no,
        fun_xodxcommst_cd_nm(d.permit_clsf, 0)        AS permit_clsf_nm,
        d.mou_contrct_ymd,
        d.contrct_cls_ymd,
        g.nm                                          AS rspns_nm,
        max(nvl(h.advnc_fee,0)) + max(NVL(h.flt_ryalty, 0))  AS contrct_fee,
        SUM(NVL(i.ofic_depst_amt, 0))                 AS ofic_depst_amt 
FROM respstaply a
INNER JOIN patmastr b ON a.smitapp_no = b.smitapp_no 
INNER JOIN respstmast d ON a.tech_fee_no = d.tech_fee_no
INNER JOIN respstcrtpagr h ON d.tech_fee_no = h.tech_fee_no 
INNER JOIN humbasicinfo  g ON d.resch_rspns_main = g.syspayno
LEFT OUTER JOIN patrelatreschprj c ON b.req_no = c.req_no
LEFT OUTER JOIN rescrtpsrecte i ON d.tech_fee_no = i.tech_fee_no 
LEFT OUTER JOIN resbgacctm j ON c.accnt_no = j.accnt_no AND j.accnt_clsf = 'RAR001'
LEFT OUTER JOIN resinpmast k ON j.prj_no = k.prj_no
WHERE b.mngmt_no = #{mngmt_no}
  AND d.tech_fee_mou_state IN ('RFJ012','RFJ013')
  AND d.mou_clsf = 'RFD001' 
 AND LENGTH(a.smitapp_no) <![CDATA[ > ]]> 0
GROUP BY 1, 2, 3, 4, 5, 6,7, 8, 9,10,11,12
ORDER BY 1, 2, 3, 5
  </select>
<select id="selectPatPsrRegInfoSS02" parameterType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo" resultType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo">
/* XDA : kitech.pat.psr.xda.PatPsrRegInfoSS02 지재권 심사청구 정보 조회 다건*/
SELECT /* QueryID : kr.re.kitech.biz.pat.psr.selectPatPsrRegInfoSS02 */ 
		 '심사청구' AS gb_nm
      , '0' AS gb
      , pd.rpt_prity_date
      , pd.demnd_id AS ref_key
      , '' AS apr_key
      , '조회' AS  view
FROM patdemnd pd
WHERE 1 = 1
AND pd.req_no = #{req_no}
AND pd.mngmt_no = #{mngmt_no}
UNION 
SELECT '우선심사청구' AS gb_nm
      , '1' AS gb
      , ppd.rpt_prity_date
      , ppd.prity_demnd_id AS ref_key
      , pper.prity_eval_req_no AS apr_key
      , '조회' AS  view
FROM patpritydemnd ppd
     LEFT JOIN patprityevalreq pper
        ON pper.mngmt_no = ppd.mngmt_no
WHERE 1 = 1
AND ppd.req_no = #{req_no}
AND ppd.mngmt_no = #{mngmt_no}
  </select>
<update id="updatePatmastrSU02" parameterType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo">
/* XDA : kitech.pat.psr.xda.PatmastrSU02 저장실적년월 저장 */
update /* QueryID : kr.re.kitech.biz.pat.psr.updatePatmastrSU02 */ 
		 patmastr set
regst_reg_ymd = #{regst_reg_ymd}
where req_no=#{req_no}
and mngmt_no=#{mngmt_no}
  </update>
<select id="selectPatSkatertHisMS03" parameterType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo" resultType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo">
/* XDA : kitech.pat.chr.xda.PatSkatertHisMS03 사건조회-지분율변경(전체)내역조회 다건*/
SELECT /* QueryID : kr.re.kitech.biz.pat.psr.selectPatSkatertHisMS03 */ 
		  t1.his_seq,
        t1.req_no,
        t1.seq,
        t1.input_ymd,
        t1.skate_clsf,
        fun_xodxcommst_cd_nm(t1.skate_clsf, 0)  AS skate_clsf_nm, 
        CASE WHEN t1.blong_clsf='PDT010' THEN '내부'
             WHEN t1.blong_clsf='PDT020' THEN '외부'
             WHEN t1.blong_clsf='1'      THEN '업체' 
             WHEN t1.blong_clsf='2'      THEN '개인'
        END AS blong_clsf_nm,
        CASE WHEN t1.skate_clsf='PAS010' THEN t1.nm_krn 
             ELSE t1.vend_nm END AS nm,
        t1.stake_rt,
        t1.stake_dept,
        t1.attach_file_no   ,
        COUNT(t4.seq)  AS cnt,
        t1.acdt_unusual_item AS rmk   
FROM  patskaterthis t1
LEFT JOIN xomxcomattachfile t4 ON t1.attach_file_no = t4.attach_file_no 
WHERE t1.req_no = #{req_no}
AND   t1.mngmt_no = #{mngmt_no}
AND  ( '' = #{skate_clsf} OR t1.skate_clsf = #{skate_clsf} )
GROUP BY 1,2,3,4,5,6,7,8,9,10,11,13
ORDER BY t1.skate_clsf, t1.input_ymd DESC, t1.his_seq DESC, t1.seq
  </select>
<select id="selectPatRelatReschPrjHisMS02" parameterType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo" resultType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo">
/* XDA : kitech.pat.chr.xda.PatRelatReschPrjHisMS02 계정변경 이력 또는 변경신청 다건*/
-- 2018.03.16. 변경신청에서 사용할 수 있도록 쿼리 변경(dynamic)
-- 2018.03.20. 변경신청 결재완료 후 소연심 안건등록을 위해 patmastr join
SELECT /* QueryID : kr.re.kitech.biz.pat.psr.selectPatRelatReschPrjHisMS02 */ 
		 a.req_no 
     , a.seq 
     , a.elecapp_docu_no
     , a.input_ymd
     , a.accnt_no
     , a.prj_no 
     , a.prj_nm 
     , a.resch_respn_syspayno 
     , a.prj_term 
     , a.attach_file_no
     , a.acdt_unusual_item
     , a.regst_syspayno 
     , a.regst_daytm
     , b.nm AS resch_respn_syspaynm
     , b.work_clsf
     , c.nm
     , c.empno
  , d.charg_syspayno
     , MAX(d.smitapp_ymd) AS smitapp_ymd  
FROM patrelatreschprjhis a
JOIN humbasicinfo b ON a.resch_respn_syspayno = b.syspayno
JOIN humbasicinfo c ON a.regst_syspayno = c.syspayno
JOIN patmastr d ON a.req_no = d.req_no
<if test="req_no != null and req_no != ''">
	 AND a.req_no = #{req_no}
</if>
<if test="elecapp_docu_no != null and elecapp_docu_no != ''">
	 AND a.elecapp_docu_no= #{elecapp_docu_no}
</if>
<if test="seq != null and seq != ''">
	 AND a.seq = #{seq}
</if>
GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18
  </select>
<select id="selectPatPsrRegInfoSS03" parameterType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo" resultType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo">
/* XDA : kitech.pat.psr.xda.PatPsrRegInfoSS03 지재권 OA 정보 조회 다건*/
SELECT /* QueryID : kr.re.kitech.biz.pat.psr.selectPatPsrRegInfoSS03 */ 
		 po.oa_id
      , po.oa_sn
      , (CASE WHEN po.rcpt_clsf = '0' or po.rcpt_clsf = '1'
               THEN '의견제출통지'
               WHEN po.rcpt_clsf = '2'
               THEN '거절결정통지'
               WHEN po.rcpt_clsf = '3'
               THEN '국외' 
         END) AS rcpt_clsf_nm
      , pf.patofic_nm
      , poc.nm AS charg_nm
      , ps.state_cd
      , TRIM(po.rcpt_oa_date) AS rcpt_oa_date
      , TRIM(po.rcpt_due_date) AS rcpt_due_date
      , ps.state_desc AS state_nm
      , TO_CHAR(po.fnsh_daytm,'%Y%m%d') AS fnsh_date
FROM patoa po
      LEFT JOIN patstatecode ps
         ON ps.state_cd = po.job_state_cd
      LEFT JOIN patoffice pf
         ON pf.patofic_cd = po.rcpt_patofic_cd
      LEFT JOIN patoficcharg poc
         ON poc.id = po.rcpt_charg_psn_id
WHERE 1 = 1
AND po.req_no = #{req_no}
AND po.mngmt_no = #{mngmt_no}
  </select>
<select id="selectPatAcdtUnusualItrmMS02" parameterType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo" resultType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo">
/* XDA : kitech.pat.chr.xda.PatAcdtUnusualItrmMS02 사건조회-특이사항탭 조회 다건*/
SELECT /* QueryID : kr.re.kitech.biz.pat.psr.selectPatAcdtUnusualItrmMS02 */ 
		  t1.req_no                   ,       -- 신청번호      
        t1.mngmt_no                 ,       -- 관리번호    
        t1.seq                      ,       -- 순번
        t1.seq AS seq_02             ,       -- 순번
        t1.input_ymd                ,       -- 입력일자
        t1.input_ymd AS input_ymd_02  ,       -- 입력일자
        t1.ntb_regst_yn             ,       -- NTB등록여부
        DECODE(t1.ntb_regst_yn, 'Y', '등록', 'N', '미등록', '') AS ntb_regst_yn_nm,
        t1.ntb_regst_ymd            ,       -- NTB등록일자
        t1.attach_file_no           ,       -- 첨부파일
        t1.attach_file_no AS attach_file_no_02          ,       -- 첨부파일 
        t1.attach_file_no_01        ,       -- 관리자용 첨부파일
        t1.acdt_unusual_item        ,       -- 사건특이사항
        COUNT(t2.seq)           AS cnt ,      -- 첨부파일갯수
        COUNT(t2.seq)           AS cnt_02      -- 첨부파일갯수
FROM    patacdtunusualitem          t1,
        OUTER(xomxcomattachfile     t2)          
WHERE   t1.attach_file_no           = t2.attach_file_no
AND     t1.req_no                   = #{req_no}
AND     t1.mngmt_no                 = #{mngmt_no}
<if test="seq != null and seq != ''">
	  AND  t1.seq  = #{seq}
</if> 
GROUP BY 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13
  </select>
<select id="selectPatPeeLstSS01" parameterType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo" resultType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo">
/* XDA : kitech.pat.pee.lst.xda.PatPeeLstSS01 외부평가 조회 다건*/
SELECT /* QueryID : kr.re.kitech.biz.pat.psr.selectPatPeeLstSS01 */ 
		 ppe.post_eval_id
      , mst.req_no
      , mst.mngmt_no
      , mst.invnt_krn_nm
      , ppe.eval_organ
      , ppe.eval_daytm
      , decode(ppe.eval_tool, '0', 'SMART 3', '2', 'SMART 5', 'K-PEG') AS eval_tool
      , ppe.eval_grade
      , mst.smitapp_no
      , mst.smitapp_ymd
      , mst.regst_no
      , mst.regst_ymd
      , mst.discu_clsf
      , case when ppe.eval_grade  <![CDATA[ >= ]]> 0  and ppe.eval_grade  <![CDATA[ <= ]]> 3  then'우수'
        else ''
        end eval_grade_yn
      , ppe.eval_attach_file
      , ppe.tech_clsf
      , ppe.eval_date
  FROM patposteval ppe
INNER JOIN patmastr mst ON mst.mngmt_no = ppe.mngmt_no
<if test="req_no != null and req_no != ''">
	 AND mst.req_no = #{req_no}
</if>
<if test="mngmt_no != null and mngmt_no != ''">
	 AND mst.mngmt_no = #{mngmt_no}
</if>
<if test="invnt_krn_nm != null and invnt_krn_nm != ''">
	 AND mst.invnt_krn_nm LIKE '%' || #{invnt_krn_nm} || '%'
</if>
<if test="start_daytm != null and start_daytm != ''">
	 AND ppe.eval_daytm  <![CDATA[ >= ]]>  #{start_daytm}
</if>
<if test="end_daytm != null and end_daytm != ''">
	 AND ppe.eval_daytm  <![CDATA[ <>>= ]]> #{end_daytm}
</if>
<if test="attach_file != null and attach_file != '' and attach_file == '1'.toString()">
	 AND NVL(ppe.eval_attach_file, '') = ''
</if>
<if test="attach_file != null and attach_file != '' and attach_file == '0'.toString()">
	 AND NVL(ppe.eval_attach_file, '') != ''
</if>
<if test="input_eval_tool != null and input_eval_tool != ''">
	 AND ppe.eval_tool = #{input_eval_tool}
</if>
  </select>
<select id="selectPatPpoFamilyLstSS01" parameterType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo" resultType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo">
/* XDA : kitech.pat.ppo.xda.PatPpoFamilyLstSS01 패밀리 조회 다건*/
SELECT /* QueryID : kr.re.kitech.biz.pat.psr.selectPatPpoFamilyLstSS01 */ 
		 pm.req_no
      , pm.mngmt_no
      , pm.invnt_krn_nm
      , pm.smitapp_no
      , pm.smitapp_ymd
      , pm.smitapp_natn_cd
      , pm.smitapp_natn_nm
FROM patmastr pm
      INNER JOIN (
        SELECT req_no, mngmt_no
        FROM patmastr pm
        WHERE 1 = 1
        AND pm.req_no = #{req_no}
        UNION 
        SELECT req_no, mngmt_no
        FROM patmastr pm
        WHERE 1 = 1
        AND NVL(TRIM(smitapp_no),'')  != ''
        AND smitapp_no = (SELECT NVL(relat_dom_smitapp_no,'XXX') FROM patmastr WHERE req_no = #{req_no} AND mngmt_no = #{mngmt_no})
        UNION 
        SELECT req_no, mngmt_no
        FROM patmastr pm
        WHERE 1 = 1
        AND NVL(TRIM(relat_dom_smitapp_no),'') !=  ''
        AND relat_dom_smitapp_no = (SELECT NVL(smitapp_no,'XXX') FROM patmastr WHERE req_no = #{req_no} AND mngmt_no = #{mngmt_no})
        UNION 
        SELECT req_no, mngmt_no
        FROM patmastr pm
        WHERE 1 = 1
        AND NVL(TRIM(relat_dom_smitapp_no),'') !=  ''
        AND relat_dom_smitapp_no = (SELECT NVL(relat_dom_smitapp_no,'XXX') FROM patmastr WHERE req_no = #{req_no} AND mngmt_no = #{mngmt_no})
      ) b ON b.req_no = pm.req_no AND b.mngmt_no = pm.mngmt_no
  </select>
<select id="selectPatPsrCostInfoSS01" parameterType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo" resultType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo">
/* XDA : kitech.pat.psr.xda.PatPsrCostInfoSS01 지식재산권 비용 정보 조회 단건*/
SELECT /* QueryID : kr.re.kitech.biz.pat.psr.selectPatPsrCostInfoSS01 */ 
		 NVL(SUM(CASE WHEN base.state_cd in ('12400')
                       THEN base.governpay_fee + base.out_governpay_fee + base.dom_comsn + base.oversea_comsn + base.dom_comsn_addtax + base.send_comsn
                       ELSE 0
                 END), 0) AS appCostSum
      , NVL(SUM(CASE WHEN base.state_cd in ('20900','22600','23000','14600')
                       THEN base.governpay_fee + base.out_governpay_fee + base.dom_comsn + base.oversea_comsn + base.dom_comsn_addtax + base.send_comsn
                       ELSE 0
                 END), 0) AS oaCostSum
      , NVL(SUM(CASE WHEN base.state_cd in ('30500')
                       THEN base.governpay_fee + base.out_governpay_fee + base.dom_comsn + base.oversea_comsn + base.dom_comsn_addtax + base.send_comsn
                       ELSE 0
                 END), 0) AS regCostSum
      , NVL(SUM(CASE WHEN base.state_cd in ('40500')
                       THEN base.governpay_fee + base.out_governpay_fee + base.dom_comsn + base.oversea_comsn + base.dom_comsn_addtax + base.send_comsn
                       ELSE 0
                 END), 0) AS annualCostSum
      , NVL(SUM(CASE WHEN base.state_cd in ('00100','00300','00400','00600','00700','15300','49000')
                       THEN base.governpay_fee + base.out_governpay_fee + base.dom_comsn + base.oversea_comsn + base.dom_comsn_addtax + base.send_comsn
                       ELSE 0
                 END), 0) AS etcCostSum
FROM (
        SELECT  pds.governpay_fee
              , pds.out_governpay_fee
              , pds.dom_comsn
              , pds.oversea_comsn
              , pds.dom_comsn_addtax
              , pds.oversea_comsn_addtax
              , pds.send_comsn
              , pds.state_cd
        FROM patexpnsdetls pds /* 지급결의 비용상세 */
            INNER JOIN patexpnsmngmt pmg 
                ON pmg.expns_mngmt_no = pds.expns_mngmt_no /*지급결의비용마스터*/
        WHERE 1 = 1
        AND NVL(pmg.unslip_no,'') != '' 
        AND pds.mngmt_no = #{mngmt_no}
      ) base
WHERE 1 = 1
  </select>
<select id="selectPatPsrCostLstSS01" parameterType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo" resultType="kr.re.kitech.biz.pat.psr.vo.PatPsrInquiryManageVo">
/* XDA : kitech.pat.psr.xda.PatPsrCostLstSS01 지식재산권 비용 정보 조회 다건*/
SELECT /* QueryID : kr.re.kitech.biz.pat.psr.selectPatPsrCostLstSS01 */ 
		 pmg.expns_mngmt_no
      , pmg.unslip_no
      , pds.acdt_contnt
      , po.patofic_nm
      , pds.governpay_fee AS governpay_fee
      , pds.out_governpay_fee
      , pds.dom_comsn AS supply_price
      , pds.oversea_comsn AS out_supply_price
      , pds.dom_comsn_addtax AS surtax
      , pds.send_comsn AS out_commission
      , pds.state_cd
      , pds.governpay_fee + pds.dom_comsn + pds.oversea_comsn + pds.dom_comsn_addtax + pds.send_comsn + pds.out_governpay_fee AS total_price
FROM patexpnsdetls pds /* 지급결의 비용상세 */
    INNER JOIN patexpnsmngmt pmg 
        ON pmg.expns_mngmt_no = pds.expns_mngmt_no /*지급결의비용마스터*/
    LEFT JOIN patoffice po
        ON po.patofic_cd = pmg.patofic_cd
WHERE 1 = 1
AND NVL(pmg.unslip_no,'') != '' 
AND pds.mngmt_no = #{mngmt_no}
<if test="cost_kind != null and cost_kind != '' and 'AA'.equalsIgnoreCase(cost_kind)">
AND pds.state_cd IN ('12400')
</if>
<if test="cost_kind != null and cost_kind != '' and 'E'.equals(cost_kind)">
AND pds.state_cd IN ('20900','22600','23000','14600')
</if>
<if test="cost_kind != null and cost_kind != '' and 'F'.equals(cost_kind)">
AND pds.state_cd IN ('30500')
</if>
<if test="cost_kind != null and cost_kind != '' and 'G'.equals(cost_kind)">
AND pds.state_cd IN ('40500')
</if>
<if test="cost_kind != null and cost_kind != '' and 'H'.equals(cost_kind)">
AND pds.state_cd IN ('00100','00300','00400','00600','00700','15300','49000')
</if>
ORDER BY unslip_no
  </select>
</mapper>